<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn" >
<head>
<title>AcegiSecurity使用说明 - WIKI-HIT IBM CLUB</title>
<meta name="KEYWORDS" content="首页,ALP,Address,Android,Android Newbie Guide,Android Project Development,Android Research Field,Android Third Party Lib And Tool,BoardGame,CSAPP" />
<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
<meta name="robots" content="index,follow" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../../../../skins/common/wikiprintable.css' />
<script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
<style type='text/css'>
/*/*/ /*<![CDATA[*/
@import "../../../../skins/common/wikistandard.css";
@import "../../../s/t/a/MediaWiki%7EStandard.css.html";
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px; border-right: 1px solid gray; }
#article { margin-left: 152px; margin-right: 4px; }

/*]]>*/ /* */
</style>
</head>

<body bgcolor='#FFFFFF' onload=''>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
<td width='152' rowspan='1'>&nbsp;</td><td class="top" align='left' valign='top'>
<a href="../../../index.html" title="首页">首页</a> |
<a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> |
<a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">编辑本页</a> |
<a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">较早版本</a><p class='subtitle'><a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html">可打印版</a> | <a href="../../../g/e/n/WIKI-HIT_IBM_CLUB%7EGeneral_disclaimer.html" title="WIKI-HIT IBM CLUB:General disclaimer">Disclaimers</a></p>
</td>
<td class="top" valign='top' align='right' nowrap='nowrap'>Not logged in
<br /><a href="../../../u/s/e/Special%7EUserlogin.html" title="Special:Userlogin">登录</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html" title="Wikipedia:帮助">帮助</a>
<br /><form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form></td></tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">AcegiSecurity使用说明</h1><p class='subtitle'>Wikipedia，自由的百科全书</p>
<table id='toc' class='toc'><tr><td><div id='toctitle'><h2>目录</h2></div>
<ul>
<li class='toclevel-1'><a href="#AcegiSecurity.E7.AE.80.E4.BB.8B"><span class="tocnumber">1</span> <span class="toctext">AcegiSecurity简介</span></a></li>
<li class='toclevel-1'><a href="#.E8.BF.90.E8.A1.8C.E6.9C.BA.E5.88.B6"><span class="tocnumber">2</span> <span class="toctext">运行机制</span></a></li>
<li class='toclevel-1'><a href="#.E9.85.8D.E7.BD.AE.E8.AF.A6.E8.A7.A3"><span class="tocnumber">3</span> <span class="toctext">配置详解</span></a>
<ul>
<li class='toclevel-2'><a href="#.E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6.E7.BB.93.E6.9E.84.E5.9B.BE"><span class="tocnumber">3.1</span> <span class="toctext">配置文件结构图</span></a>
<ul>
<li class='toclevel-3'><a href="#.E8.AF.B4.E6.98.8E"><span class="tocnumber">3.1.1</span> <span class="toctext">说明</span></a></li>
</ul>
</li>
</ul>
</li>
<li class='toclevel-1'><a href="#.E6.B3.A8.E6.84.8F.E9.97.AE.E9.A2.98"><span class="tocnumber">4</span> <span class="toctext">注意问题</span></a>
<ul>
<li class='toclevel-2'><a href="#login.E9.97.AE.E9.A2.98"><span class="tocnumber">4.1</span> <span class="toctext">login问题</span></a></li>
<li class='toclevel-2'><a href="#JUnit.E6.B5.8B.E8.AF.95.E9.97.AE.E9.A2.98"><span class="tocnumber">4.2</span> <span class="toctext">JUnit测试问题</span></a></li>
</ul>
</li>
</ul>
</td></tr></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "显示"; var tocHideText = "隐藏"; showTocToggle(); } </script>
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">编辑</a>]</div><a name="AcegiSecurity.E7.AE.80.E4.BB.8B"></a><h2>AcegiSecurity简介</h2>
<p>Acegi Security is a powerful, flexible security solution for enterprise software, with a particular emphasis on applications that use Spring. Using Acegi Security provides your applications with comprehensive authentication, authorization, instance-based access control, channel security and human user detection capabilities. <a href="http://www.acegisecurity.org/" class='external text' title="http://www.acegisecurity.org/" rel="nofollow">官方网站介绍</a>
</p><p>AcegiSecurity是一套基于Spring框架的权限验证机制，他对web项目的代码侵入很少，主要靠配置文件进行管理和设定，可以对URI及内部方法进行严格的权限过滤，自带了登陆功能。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">编辑</a>]</div><a name=".E8.BF.90.E8.A1.8C.E6.9C.BA.E5.88.B6"></a><h2>运行机制</h2>
<p>从其xml配置文件的这张图，能够清楚地理解整个框架都有哪些部分，各部分的组成及功能，下面就来详细的说一说。
</p>
<ol><li>filterChainProxy:这一层是最上层，负责给各种filter进行排队，filter对列初始化
<ol><li>httpSessionContextIntegrationFilter:
</li><li>authenticationProcessingFilter:这个bean用于进行用户身份验证，他有三个String代表的URL成员，分别指向验证失败页面、默认成功跳转页面、验证触发url，另外还有一个authenticationManager。
<ol><li>authenticatinoManager:它包含一个provider的list，利用provider提供身份验证。这里有三个provider，分别是权限用户验证、匿名用户验证、testing验证，如果验证通过，provider会返回Authentication对象。
</li></ol>
</li><li>anonymousProcessingFilter:这个bean只设定了两个值，key用于其内部完成equals()方法，userAttribute则是配置url、对象方法访问权限的关键字（？不过他的类型对应关系及bean的构建还没看懂，参看源代码？）他应该完成匿名用户的过滤。
</li><li>filterInvocationIntereptor:这个bean用于url申请的验证，借由accessDecisionManager按照指定的投票原则进行投票，决定当前用户是否有权访问这个url，而objectDefinationSource用key=value的模式保存了所有的权限配置，authenticationManager用户处理用户部分的操作。
</li><li>最后是expectionTransactionFilter保存了login表单的位置，可以配置是否强制使用https安全连接。
</li></ol>
</li></ol>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">编辑</a>]</div><a name=".E9.85.8D.E7.BD.AE.E8.AF.A6.E8.A7.A3"></a><h2>配置详解</h2>
<p>applicationContext-acegi-security.xml
</p>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "<a href="http://www.springframework.org/dtd/spring-beans.dtd" class='external free' title="http://www.springframework.org/dtd/spring-beans.dtd" rel="nofollow">http://www.springframework.org/dtd/spring-beans.dtd</a>"&gt;
	
	
&lt;beans&gt;
	
	&lt;bean id="filterChainProxy" class="org.acegisecurity.util.FilterChainProxy"&gt;
		&lt;property name="filterInvocationDefinitionSource"&gt;
			&lt;value&gt;
			CONVERT_URL_TO_LOWERCASE_BEFORE_COMPARISON 
			PATTERN_TYPE_APACHE_ANT 
				 /**=httpSessionContextIntegrationFilter,authenticationProcessingFilter,anonymousProcessingFilter,filterInvocationInterceptor,exceptionTranslationFilter
			&lt;/value&gt;
		&lt;/property&gt;
	&lt;/bean&gt;
	
	
	&lt;bean id="filterInvocationInterceptor" class="org.acegisecurity.intercept.web.FilterSecurityInterceptor"&gt;
		&lt;property name="authenticationManager"&gt;
			&lt;ref bean="authenticationManager" /&gt;
		&lt;/property&gt;
		&lt;property name="accessDecisionManager" ref="accessDecisionManager" /&gt;
		&lt;property name="objectDefinitionSource"&gt;
			&lt;value&gt;
			CONVERT_URL_TO_LOWERCASE_BEFORE_COMPARISON 
			PATTERN_TYPE_APACHE_ANT 
			/**/*.jpg=ROLE_ANONYMOUS,user,admin 
			/**/*.gif=ROLE_ANONYMOUS,user,admin 
			/**/*.png=ROLE_ANONYMOUS,user,admin 
			/**/*.css=ROLE_ANONYMOUS,user,admin
			/index.jsp=ROLE_ANONYMOUS,user,admin
			/jsp/index.jsp*=ROLE_ANONYMOUS,user,admin
			/login.htm=ROLE_ANONYMOUS,user,admin
			/**/*.htm*=user,admin
			/*.htm=user,admin
			&lt;/value&gt;
		&lt;/property&gt;
	&lt;/bean&gt;
	
	&lt;bean id="authenticationManager" class="org.acegisecurity.providers.ProviderManager"&gt;
		&lt;property name="providers"&gt;
			&lt;list&gt;
				&lt;ref local="daoAuthenticationProvider" /&gt;
				&lt;ref local="anonymousAuthenticationProvider" /&gt;
				&lt;ref local="testingAuthenticationProvider" /&gt;
			&lt;/list&gt;
		&lt;/property&gt;
	&lt;/bean&gt;
	
	&lt;bean id="testingAuthenticationProvider" class="org.acegisecurity.providers.TestingAuthenticationProvider" /&gt;
			
	
	
	&lt;bean id="loggerListener" class="org.acegisecurity.event.authentication.LoggerListener" /&gt;
	
	&lt;bean id="daoAuthenticationProvider" class="org.acegisecurity.providers.dao.DaoAuthenticationProvider"&gt;
		
		&lt;property name="userDetailsService" ref="userDao" /&gt;
		&lt;property name="passwordEncoder" ref="passwordEncoder"/&gt;
		&lt;property name="userCache" ref="userCache"/&gt;
	&lt;/bean&gt;
	
	&lt;bean id="passwordEncoder" class="org.acegisecurity.providers.encoding.Md5PasswordEncoder"/&gt;
	
	&lt;bean id="anonymousAuthenticationProvider" class="org.acegisecurity.providers.anonymous.AnonymousAuthenticationProvider"&gt;
		&lt;property name="key" value="anonymous" /&gt;
	&lt;/bean&gt;
	
	
	&lt;bean id="roleVoter" class="org.acegisecurity.vote.RoleVoter"&gt;
		&lt;property name="rolePrefix" value="" /&gt;
	&lt;/bean&gt;
	
	&lt;bean id="accessDecisionManager" class="org.acegisecurity.vote.AffirmativeBased"&gt;
		&lt;property name="allowIfAllAbstainDecisions" value="false" /&gt;
		&lt;property name="decisionVoters"&gt;
			&lt;list&gt;
				&lt;ref local="roleVoter" /&gt;
			&lt;/list&gt;
		&lt;/property&gt;
	&lt;/bean&gt;
	
	
	&lt;bean id="httpSessionContextIntegrationFilter" class="org.acegisecurity.context.HttpSessionContextIntegrationFilter" /&gt;
	
	&lt;bean id="authenticationProcessingFilter" class="org.scholar.web.ScholarAuthenticationProcessingFilter"&gt;
		&lt;property name="authenticationManager" ref="authenticationManager" /&gt;
		&lt;property name="authenticationFailureUrl" value="/jsp/index.jsp" /&gt;
		&lt;property name="defaultTargetUrl" value="/login.htm" /&gt;
		&lt;property name="filterProcessesUrl" value="/acegi_login" /&gt;
	&lt;/bean&gt;
	
	&lt;bean id="anonymousProcessingFilter" class="org.acegisecurity.providers.anonymous.AnonymousProcessingFilter"&gt;
		&lt;property name="key" value="anonymous" /&gt;
		&lt;property name="userAttribute" value="anonymousUser,ROLE_ANONYMOUS" /&gt;
	&lt;/bean&gt;
	
	&lt;bean id="exceptionTranslationFilter" class="org.acegisecurity.ui.ExceptionTranslationFilter"&gt;
		&lt;property name="authenticationEntryPoint" ref="authenticationProcessingFilterEntryPoint" /&gt;
	&lt;/bean&gt;
	
	&lt;bean id="authenticationProcessingFilterEntryPoint" class="org.acegisecurity.ui.webapp.AuthenticationProcessingFilterEntryPoint"&gt;
		&lt;property name="loginFormUrl" value="/jsp/index.jsp" /&gt;
		&lt;property name="forceHttps" value="false" /&gt;
	&lt;/bean&gt;
	
	
	&lt;bean id="txProxyTemplate" abstract="true" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
		&lt;property name="transactionManager" ref="transactionManager" /&gt;
		&lt;property name="transactionAttributes"&gt;
			&lt;props&gt;
				&lt;prop key="save*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
				&lt;prop key="remove*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
				&lt;prop key="*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
			&lt;/props&gt;
		&lt;/property&gt;
	&lt;/bean&gt;
	
	&lt;bean id="userCache" class="org.acegisecurity.providers.dao.cache.EhCacheBasedUserCache"&gt;
		&lt;property name="cache"&gt;
			&lt;bean class="org.springframework.cache.ehcache.EhCacheFactoryBean"&gt;
				&lt;property name="cacheManager"&gt;
					&lt;bean class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean" /&gt;
				&lt;/property&gt;
				&lt;property name="cacheName" value="userCache" /&gt;
			&lt;/bean&gt;
		&lt;/property&gt;
	&lt;/bean&gt;
	
	
	&lt;bean id="userManager" parent="txProxyTemplate"&gt;
		&lt;property name="target"&gt;
			&lt;bean class="org.scholar.service.impl.UserManager"&gt;
				&lt;property name="dao" ref="userDao" /&gt;
			&lt;/bean&gt;
		&lt;/property&gt;
	
		&lt;property name="transactionAttributes"&gt;
			&lt;props&gt;
	
			&lt;/props&gt;
		&lt;/property&gt;
		&lt;property name="preInterceptors"&gt;
			&lt;list&gt;
				&lt;ref bean="userManagerSecurity" /&gt;
			&lt;/list&gt;
		&lt;/property&gt;
	&lt;/bean&gt;
		
	
	&lt;bean id="userManagerSecurity" class="org.acegisecurity.intercept.method.aopalliance.MethodSecurityInterceptor"&gt;
		&lt;property name="authenticationManager" ref="authenticationManager" /&gt;
		&lt;property name="accessDecisionManager" ref="accessDecisionManager" /&gt;
		&lt;property name="objectDefinitionSource"&gt;
			&lt;value&gt;
			org.scholar.service.IUserManager.getUser=admin,user
			org.scholar.service.IUserManager.getUserByEmail=admin,ROLE_ANONYMOUS,user
			org.scholar.service.IUserManager.getUserByNoActivateMail=admin,ROLE_ANONYMOUS
			org.scholar.service.IUserManager.getUsers=admin,user
			org.scholar.service.IUserManager.saveUser=admin,user,ROLE_ANONYMOUS
			org.scholar.service.IUserManager.removeUser=admin
			org.scholar.service.IUserManager.updateUser=admin,user
			&lt;/value&gt;
		&lt;/property&gt;
	&lt;/bean&gt;
	
&lt;/beans&gt;
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">编辑</a>]</div><a name=".E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6.E7.BB.93.E6.9E.84.E5.9B.BE"></a><h3>配置文件结构图</h3>
<p><a href="../../../m/a/p/Image%7EMap.jpeg.html" class="image" title="Image:Map.jpeg"><img src="../../../../upload/2/24/Map.jpeg" alt="Image:Map.jpeg" width="2676" height="703" longdesc="../../../m/a/p/Image%7EMap.jpeg.html" /></a>
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">编辑</a>]</div><a name=".E8.AF.B4.E6.98.8E"></a><h4>说明</h4>
<table border="1">
<tr>
<td align="left">key
</td><td align="center">在其内部只负责生成hashcode，用这个hashcode来判断两个AnonymousAuthenticationToken是否相等。
</td></tr>
<tr>
<td align="left">loginFormUrl
</td><td align="center">登录表单所在的URL
</td></tr>
<tr>
<td align="left">forceHttps
</td><td align="center">forceHttps:强制使用https安全连接，如果为true则有效，false可以使用http
</td></tr></table>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">编辑</a>]</div><a name=".E6.B3.A8.E6.84.8F.E9.97.AE.E9.A2.98"></a><h2>注意问题</h2>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">编辑</a>]</div><a name="login.E9.97.AE.E9.A2.98"></a><h3>login问题</h3>
<p>他本身提供的login功能的配置bean中有一个参数是rememberMe，用于记录登录用户信息（用户名、密码、权限等级，双层加密），其实现是将这段信息保存在cookie中，默认最长保存时间14天，注销的时候在页面代码里置空该cookie，并将其生命周期设为零，实现logout。
</p><p>如果想不用cookie保存用户信息，而是将其加入到session中，可以在你的登录action（如org.scholar.web.LoginAction）中加入如下类似代码：
</p>
<pre>protected ModelAndView handleRequestInternal(HttpServletRequest req,
	HttpServletResponse res) {
	Object obj = SecurityContextHolder.getContext().getAuthentication()
		.getPrincipal(); //从SecurityContext中获取principal对象
	
	User currentUser = (User) obj; //User已经实现了org.acegisecurity.userdetails.UserDetail接口
	HttpSession session = req.getSession();
	session.setAttribute(CURRENT_USER, currentUser);//将获得的currentUser加入到session中
	return new ModelAndView(successPage);
	
}
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">编辑</a>]</div><a name="JUnit.E6.B5.8B.E8.AF.95.E9.97.AE.E9.A2.98"></a><h3>JUnit测试问题</h3>
<p>由于AcegiSecurity这层保护机制不需要启动Tomcat就可以起作用，所以在测试Action的时候会出现权限的问题，系统会报出下述错误：
</p>
<pre>org.acegisecurity.AuthenticationCredentialsNotFoundException: An Authentication object was not found in the SecurityContext
	at org.acegisecurity.intercept.AbstractSecurityInterceptor.credentialsNotFound(AbstractSecurityInterceptor.java:329)
	at org.acegisecurity.intercept.AbstractSecurityInterceptor.beforeInvocation(AbstractSecurityInterceptor.java:244)
	at org.acegisecurity.intercept.method.aopalliance.MethodSecurityInterceptor.invoke(MethodSecurityInterceptor.java:63)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:144)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:174)
	at $Proxy1.getUserByNoActivateMail(Unknown Source)
	at org.scholar.web.UserAction.activate(UserAction.java:146)
	at org.scholar.web.UserActionTest.testActivate(UserActionTest.java:93)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
	at java.lang.reflect.Method.invoke(Unknown Source)
	at junit.framework.TestCase.runTest(TestCase.java:154)
	at junit.framework.TestCase.runBare(TestCase.java:127)
	at junit.framework.TestResult$1.protect(TestResult.java:106)
	at junit.framework.TestResult.runProtected(TestResult.java:124)
	at junit.framework.TestResult.run(TestResult.java:109)
	at junit.framework.TestCase.run(TestCase.java:118)
	at junit.framework.TestSuite.runTest(TestSuite.java:208)
	at junit.framework.TestSuite.run(TestSuite.java:203)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:478) 
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:344)
</pre>
<p>这是因为SecurityContext中没有任何一个用户信息，就连ROLE_ANONYMOUS也没有，所以不会通过权限验证。幸而AcegiSecurity提供了org.acegisecurity.providers.TestingAuthenticationProvider和TestingAuthenticationToken这两个类，专门用于在Junit下进行测试。
</p>
<ul><li>要想使用他们两个做测试要先进行xml配置文件的修改：
</li></ul>
<p>在applicationContext-acegi-security.xml（或等同的xml文件）中找到
</p>
<pre>&lt;bean id="authenticationManager" class="org.acegisecurity.providers.ProviderManager"&gt;
	&lt;property name="providers"&gt;
		&lt;list&gt;
			&lt;ref local="daoAuthenticationProvider" /&gt;
			&lt;ref local="anonymousAuthenticationProvider" /&gt;
		&lt;/list&gt;
	&lt;/property&gt;
&lt;/bean&gt;
</pre>
<p>这一段，在list中添加新的一行
</p>
<pre>&lt;ref local="testingAuthenticationProvider" /&gt;
</pre>
<p>同时，要添加新的bean
</p>
<pre>&lt;bean id="testingAuthenticationProvider" class="org.acegisecurity.providers.TestingAuthenticationProvider" /&gt;
</pre>
<p>这样就将TestingAuthenticationProvider添加到用户身份验证中来了，下面是修改Test文件（这里认为每个Test类都继承自BaseWebTestCase）
</p><p>在BaseWebTestCase中添加两个新成员：
</p>
<pre>	private static SecurityContextImpl secureContext = null;
	
	private static ApplicationContext ctx = null;
	
	// This static block ensures that Spring's BeanFactory is only loaded once
	// for all tests
	static {
	
		ctx = new ClassPathXmlApplicationContext(
				"classpath*:/applicationContext-*.xml"); //加载你的所有配置文件
	}
</pre>
<p>还需要添加一个新的方法
</p>
<pre>private static void createSecureContext() {
	
	TestingAuthenticationToken auth = new TestingAuthenticationToken(
			"liushi@cs.edu.cn", "fdswetwv",   //第一个参数是用户名、第二个是密码，任意
			new GrantedAuthority[] { new GrantedAuthorityImpl("admin"),
					new GrantedAuthorityImpl("ROLE_ANONYMOUS") });
	//上面的GrantedAuthorityImpl对象为用户的权限身份，要求加入你系统真正配置的权限等级名称，不可随便填写
	
	secureContext = new SecurityContextImpl(); 
	secureContext.setAuthentication(auth);
	SecurityContextHolder.setContext(secureContext); 将这个TestingAuthenticationToken 添加到SecurityContext中。
	
	}
</pre>
<p>最后，只需要在BaseWebTestCase的<b>构造方法里调用createSecureContext()</b>即可。
</p>
<div class="printfooter">
<p>取自"<a href="http://dns.cs.hit.edu.cn../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html">http://dns.cs.hit.edu.cn../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html</a>"</p>

<p>本页面已经被浏览24次。 This page was last modified 07:47 2006年7月25日 by <a href="../../../d/y/i/User%7EDyingcow.html" title="User:Dyingcow">刘奭</a>.  </p>
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'><strong><a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">编辑本页</a></strong> |
<a href="../../../a/c/e/Talk%7EAcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_1d2b.html" class="new" title="Talk:AcegiSecurity使用说明">讨论本页</a> |
<a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">较早版本</a> |
<a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a> |
<a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><br />

<br /><a href="../../../index.html" title="首页">首页</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%85%B3%E4%BA%8E.html" title="Wikipedia:关于">关于Wikipedia</a> | <a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> | <form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form><br /><span id="pagestats">本页面已经被浏览24次。 This page was last modified 07:47 2006年7月25日 by <a href="../../../d/y/i/User%7EDyingcow.html" title="User:Dyingcow">刘奭</a>.  </span></td></tr></table>
</div>
</div>

<div id='quickbar'>
<a href='../../../index.html'><img src='../../../../skins/common/images/wiki.jpg' alt='[首页]' /></a>
<hr class='sep' /><a href="../../../index.html">首页</a>
<br /><a href="../../../c/o/m/WIKI-HIT_IBM_CLUB%7ECommunity_Portal_9150.html">社区</a>
<br /><a href="../../../c/u/r/Current_events.html">新闻动态</a>
<br /><a href="../../../r/e/c/Special%7ERecentchanges.html">最近更改</a>
<br /><a href="../../../r/a/n/Special%7ERandom.html">随机页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html">帮助</a>
<br /><a href="../../../s/i/t/WIKI-HIT_IBM_CLUB%7ESite_support.html">Donations</a>
<br />
<hr class='sep' /><strong><a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">编辑本页</a></strong>
<br /><a href="../../../a/c/e/Talk%7EAcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_1d2b.html" class="new" title="Talk:AcegiSecurity使用说明">讨论本页</a>
<br /><a href="../../../a/c/e/AcegiSecurity%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_3cba.html" title="AcegiSecurity使用说明">较早版本</a>
<br /><a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a>
<br /><a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><hr class='sep' /><a href="../../../s/p/e/Special%7ESpecialpages.html" title="Special:Specialpages">特殊页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E9%94%99%E8%AF%AF%E6%8A%A5%E5%91%8A.html" title="Wikipedia:错误报告">错误报告</a>
<br /></div>
<!-- Served by dns.cs.hit.edu.cn in 1351392866.97 secs. -->
</body></html>