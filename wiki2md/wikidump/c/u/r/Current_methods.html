<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn" >
<head>
<title>Current methods - WIKI-HIT IBM CLUB</title>
<meta name="KEYWORDS" content="首页,ALP,Address,Android,Android Newbie Guide,Android Project Development,Android Research Field,Android Third Party Lib And Tool,BoardGame,CSAPP" />
<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
<meta name="robots" content="index,follow" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../../../../skins/common/wikiprintable.css' />
<script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
<style type='text/css'>
/*/*/ /*<![CDATA[*/
@import "../../../../skins/common/wikistandard.css";
@import "../../../s/t/a/MediaWiki%7EStandard.css.html";
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px; border-right: 1px solid gray; }
#article { margin-left: 152px; margin-right: 4px; }

/*]]>*/ /* */
</style>
</head>

<body bgcolor='#FFFFFF' onload=''>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
<td width='152' rowspan='1'>&nbsp;</td><td class="top" align='left' valign='top'>
<a href="../../../index.html" title="首页">首页</a> |
<a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> |
<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑本页</a> |
<a href="../../../c/u/r/Current_methods.html" title="Current methods">较早版本</a><p class='subtitle'><a href="../../../c/u/r/Current_methods.html">可打印版</a> | <a href="../../../g/e/n/WIKI-HIT_IBM_CLUB%7EGeneral_disclaimer.html" title="WIKI-HIT IBM CLUB:General disclaimer">Disclaimers</a></p>
</td>
<td class="top" valign='top' align='right' nowrap='nowrap'>Not logged in
<br /><a href="../../../u/s/e/Special%7EUserlogin.html" title="Special:Userlogin">登录</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html" title="Wikipedia:帮助">帮助</a>
<br /><form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form></td></tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">Current methods</h1><p class='subtitle'>Wikipedia，自由的百科全书</p>
<table id='toc' class='toc'><tr><td><div id='toctitle'><h2>目录</h2></div>
<ul>
<li class='toclevel-1'><a href="#about_K42"><span class="tocnumber">1</span> <span class="toctext">about K42</span></a>
<ul>
<li class='toclevel-2'><a href="#K42.E7.9A.84.E5.8A.A8.E6.80.81.E6.9B.B4.E6.96.B0.E8.BF.87.E7.A8.8B.E5.88.86.E6.9E.90"><span class="tocnumber">1.1</span> <span class="toctext">K42的动态更新过程分析</span></a>
<ul>
<li class='toclevel-3'><a href="#Dynamic_Update.E7.9A.84.E4.B8.BB.E8.A6.81.E5.9B.B0.E9.9A.BE"><span class="tocnumber">1.1.1</span> <span class="toctext">Dynamic Update的主要困难</span></a></li>
<li class='toclevel-3'><a href="#.E5.BC.BA.E5.88.B6.E5.B0.86.E6.89.80.E6.9C.89.E6.95.B0.E6.8D.AE.E5.B0.81.E8.A3.85.E8.BF.9B.E7.B1.BB"><span class="tocnumber">1.1.2</span> <span class="toctext">强制将所有数据封装进类</span></a></li>
<li class='toclevel-3'><a href="#Hot-Swapping.E8.BF.87.E7.A8.8B"><span class="tocnumber">1.1.3</span> <span class="toctext">Hot-Swapping过程</span></a>
<ul>
<li class='toclevel-4'><a href="#Hot-Swapping.E7.9A.84.E5.87.A0.E4.B8.AA.E5.9F.BA.E6.9C.AC.E6.A6.82.E5.BF.B5"><span class="tocnumber">1.1.3.1</span> <span class="toctext">Hot-Swapping的几个基本概念</span></a></li>
<li class='toclevel-4'><a href="#Hot-Swapping.E7.9A.84.E6.B5.81.E7.A8.8B"><span class="tocnumber">1.1.3.2</span> <span class="toctext">Hot-Swapping的流程</span></a></li>
<li class='toclevel-4'><a href="#mediator.E7.9A.84.E5.BF.85.E8.A6.81.E6.80.A7"><span class="tocnumber">1.1.3.3</span> <span class="toctext">mediator的必要性</span></a></li>
</ul>
</li>
<li class='toclevel-3'><a href="#Dynamic_Update.E8.BF.87.E7.A8.8B"><span class="tocnumber">1.1.4</span> <span class="toctext">Dynamic Update过程</span></a>
<ul>
<li class='toclevel-4'><a href="#Dynamic_Update.E5.AF.B9.E7.B3.BB.E7.BB.9F.E7.9A.84.E5.9F.BA.E6.9C.AC.E8.A6.81.E6.B1.82.E2.94.80.E2.94.80.E6.88.91.E7.9A.84.E7.90.86.E8.A7.A3"><span class="tocnumber">1.1.4.1</span> <span class="toctext">Dynamic Update对系统的基本要求──我的理解</span></a></li>
<li class='toclevel-4'><a href="#Dynamic_Update.E7.9A.84.E5.87.A0.E4.B8.AA.E5.9F.BA.E6.9C.AC.E6.A6.82.E5.BF.B5"><span class="tocnumber">1.1.4.2</span> <span class="toctext">Dynamic Update的几个基本概念</span></a></li>
<li class='toclevel-4'><a href="#Dynamic_Update.E7.9A.84.E6.B5.81.E7.A8.8B"><span class="tocnumber">1.1.4.3</span> <span class="toctext">Dynamic Update的流程</span></a></li>
</ul>
</li>
</ul>
</li>
<li class='toclevel-2'><a href="#.E5.85.B3.E4.BA.8EK42.E6.96.B9.E6.B3.95.E5.9C.A8Linux.E4.B8.8A.E5.BA.94.E7.94.A8.E7.9A.84.E4.B8.80.E4.BA.9B.E8.80.83.E8.99.91"><span class="tocnumber">1.2</span> <span class="toctext">关于K42方法在Linux上应用的一些考虑</span></a></li>
</ul>
</li>
</ul>
</td></tr></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "显示"; var tocHideText = "隐藏"; showTocToggle(); } </script>
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name="about_K42"></a><h1>about K42</h1>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name="K42.E7.9A.84.E5.8A.A8.E6.80.81.E6.9B.B4.E6.96.B0.E8.BF.87.E7.A8.8B.E5.88.86.E6.9E.90"></a><h2>K42的动态更新过程分析</h2>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name="Dynamic_Update.E7.9A.84.E4.B8.BB.E8.A6.81.E5.9B.B0.E9.9A.BE"></a><h3>Dynamic Update的主要困难</h3>
<p>考虑DU的整个过程，三个主要的难点如下：
</p><p>（1）如果有一个更新的主控模块，如何实现该模块的更新
</p><p>（2）更新的最小单位问题：是整个进程，还是细化到一个数据结构、一条语句
</p><p>（3）对于已经建立起来的数据结构，如果其结构在更新过程中有所扩充，应该如何处理
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name=".E5.BC.BA.E5.88.B6.E5.B0.86.E6.89.80.E6.9C.89.E6.95.B0.E6.8D.AE.E5.B0.81.E8.A3.85.E8.BF.9B.E7.B1.BB"></a><h3>强制将所有数据封装进类</h3>
<p>既是一种无奈，又是一种自然的解决方案
</p><p>K42能够实现所有部分的更新，除了很好的模块化以外，一个对系统很强的限制就是所有的数据必须封装进类。这样导致用户程序的编写受到了很大的限制，但同时解决了DU难点中的后两个。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name="Hot-Swapping.E8.BF.87.E7.A8.8B"></a><h3>Hot-Swapping过程</h3>
<p>在讨论K42的DU过程之前，先弄清另一个概念：Hot-Swapping。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name="Hot-Swapping.E7.9A.84.E5.87.A0.E4.B8.AA.E5.9F.BA.E6.9C.AC.E6.A6.82.E5.BF.B5"></a><h4><b>Hot-Swapping的几个基本概念</b></h4>
<p>（1）OTT：Object Translation Table。一个实现对对象中的函数进行间接引用的表
</p><p>（2）mediator：一个中间件，在更新之前，OTT与被更新类有关的指针被重定向到其上，再由mediator指向旧的类。mediator可以对使用它的线程进行追踪。
</p><p>（3）quiescent：系统的一个状态，此状态下待更新对象没有被任何线程调用
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name="Hot-Swapping.E7.9A.84.E6.B5.81.E7.A8.8B"></a><h4><b>Hot-Swapping的流程</b></h4>
<p>（1）建立mediator，线程对类函数的新的调用将被重定向到其上
</p><p>（2）此时，对类函数进行调用的线程分为两类：通过原来的OTT项进行调用的和通过mediator进行调用的。系统等待通过原来OTT项进行的函数调用运行结束。
</p><p>（3）现在剩下的对类函数进行调用的进程只剩下一类。此时系统禁止任何指向mediator的调用，调用线程被阻塞。但为了防止死锁，已建立连接的线程对类函数的再次调用是被允许的。这个过程是人为地制造quiescent状态。
</p><p>（4）State transfer。前面一直都在谈函数的调用，但函数的更新似乎不需要就的函数传递什么状态。但Hot-Swapping不止是对类函数的更新，还有对已建立的对象的更新。此时OTT项不再是对函数的引用，而是对一个全局对象的引用，线程对其的引用实际上是通过类函数对其进行操作。也就是说一个线程理论上在使用一个对象时需要建立两个连接，一个指向函数，一个指向数据。<b>论文中没有这样写，以上都是我的理解，不知是否正确。请C++牛人们来批评改正。</b>
</p><p>（5）重新建立OTT项到新的类或新的对象的连接，以后线程都是通过OTT对类或对象进行引用
</p><p>（6）当所有通过mediator建立的连接工作结束后，删除mediator和old object（这个在哪里删除都可以，也可以不删除）
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name="mediator.E7.9A.84.E5.BF.85.E8.A6.81.E6.80.A7"></a><h4>mediator的必要性</h4>
<p>一个object不知道自己被几个线程引用，这些线程都是什么。必须对这个类加入类似于引用计数的方法，即文中所说的generation counter。但这个counter应该在哪里实现呢？这个问题事实上等价于quiescent detection，论文中提出了两种方案，一种是在线程中记录，这会导致QD过程具有很高的时间复杂度。另一种方法就是在类的函数的开头和结尾中加入atomic counter，但如果在object中实现，那就要求每个object的编写者都实现这样一套机制。不知K42中如何实现，可能还有另外一种方法，类似SAFER的DFA方法。
</p><p>但至少一个object是不知道自己被谁调用的。
</p><p>mediator知道在其上建立连接的线程个数及其标号。从而实现了对新引用的屏蔽和对递归调用的允许，促使系统进入quiescent状态。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name="Dynamic_Update.E8.BF.87.E7.A8.8B"></a><h3>Dynamic Update过程</h3>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name="Dynamic_Update.E5.AF.B9.E7.B3.BB.E7.BB.9F.E7.9A.84.E5.9F.BA.E6.9C.AC.E8.A6.81.E6.B1.82.E2.94.80.E2.94.80.E6.88.91.E7.9A.84.E7.90.86.E8.A7.A3"></a><h4><b>Dynamic Update对系统的基本要求──我的理解</b></h4>
<p>（1）Updatable unit：动态更新的最小单位，对该单位的更新不会影响系统的其他部分。在Linux的模块动态加载中，一个Kernel Module就是这样的一个最小单位（见1.2小节）。而在K42中，这个单位是类的一个实例，也就是对象。从而进程的数据也必须封装进类中，正如前面所说，这是一种“无奈”，但它很自然的解决了上面提到的结构体扩充问题。
</p><p>（2）Safe point：当待更新的模块没有被调用时，更新可以进行。这个Safe point在K42中如前一节所说是人为制造出来的。此外，这种“人为制造”给中断处理程序动态更新带来了难度。
</p><p>（3）State tracking：对于已建立的对象，在动态更新时需要获得它们的位置并将其转换成新版本。这个工作有Factory完成，Foctory除完成tracking工作以外，还负责对象的建立和删除。
</p><p>（4）State transfer：将旧模块的状态传递给新模块从而使更新后的系统能够接着原来的状态继续运行。为此， 在设计每个类时需要编写export和import functions。
</p><p><br />
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name="Dynamic_Update.E7.9A.84.E5.87.A0.E4.B8.AA.E5.9F.BA.E6.9C.AC.E6.A6.82.E5.BF.B5"></a><h4><b>Dynamic Update的几个基本概念</b></h4>
<p>（1）Factory
</p><p>（2）另一种OTT──Factory Reference
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name="Dynamic_Update.E7.9A.84.E6.B5.81.E7.A8.8B"></a><h4>Dynamic Update的流程</h4>
<p>K42的Dynamic Update流程是两个Hot Swapping过程：
</p><p>第一个：OTT是Factory Ref，unit是Factory。
</p><p>第二个：OTT就是OTT，unit是普通的instance。
</p><p>OTT和Hot Swapping的合作使得Factory也是可更新的。
</p><p>对于结构体扩张问题，K42的解决方法是建立一个新的instance，然后state transfer。即对每个对象，重新建立一个新对象，在safe point（即该对象的quiescent状态）将旧对象的状态赋予新对象，再进行调用转移，这个过程就是Hot-Swapping过程。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑</a>]</div><a name=".E5.85.B3.E4.BA.8EK42.E6.96.B9.E6.B3.95.E5.9C.A8Linux.E4.B8.8A.E5.BA.94.E7.94.A8.E7.9A.84.E4.B8.80.E4.BA.9B.E8.80.83.E8.99.91"></a><h2>关于K42方法在Linux上应用的一些考虑</h2>
<p>Linux的updatable unit就是module本身。所以一个系统中的updatable unit也未必要有统一的模式。如果将updatable unit再抽象出一层，就可以按照作者的要求自定义updatable unit。
</p><p>某些资源无法表示成类中的一个元素，也不会受到更新的影响。比如file。
</p><p>对于文件系统来说，自动更新对某些元素来说是不现实的，比如inode的更新。即使内存中的更新了，硬盘上的inode也是没有办法改的。
</p>
<div class="printfooter">
<p>取自"<a href="http://dns.cs.hit.edu.cn../../../c/u/r/Current_methods.html">http://dns.cs.hit.edu.cn../../../c/u/r/Current_methods.html</a>"</p>

<p>本页面已经被浏览19次。 This page was last modified 14:49 2007年11月29日 by <a href="../../../y/u/m/User%7EYumo.html" title="User:Yumo">于墨</a>.  </p>
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'><strong><a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑本页</a></strong> |
<a href="../../../c/u/r/Talk%7ECurrent_methods.html" class="new" title="Talk:Current methods">讨论本页</a> |
<a href="../../../c/u/r/Current_methods.html" title="Current methods">较早版本</a> |
<a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a> |
<a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><br />

<br /><a href="../../../index.html" title="首页">首页</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%85%B3%E4%BA%8E.html" title="Wikipedia:关于">关于Wikipedia</a> | <a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> | <form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form><br /><span id="pagestats">本页面已经被浏览19次。 This page was last modified 14:49 2007年11月29日 by <a href="../../../y/u/m/User%7EYumo.html" title="User:Yumo">于墨</a>.  </span></td></tr></table>
</div>
</div>

<div id='quickbar'>
<a href='../../../index.html'><img src='../../../../skins/common/images/wiki.jpg' alt='[首页]' /></a>
<hr class='sep' /><a href="../../../index.html">首页</a>
<br /><a href="../../../c/o/m/WIKI-HIT_IBM_CLUB%7ECommunity_Portal_9150.html">社区</a>
<br /><a href="../../../c/u/r/Current_events.html">新闻动态</a>
<br /><a href="../../../r/e/c/Special%7ERecentchanges.html">最近更改</a>
<br /><a href="../../../r/a/n/Special%7ERandom.html">随机页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html">帮助</a>
<br /><a href="../../../s/i/t/WIKI-HIT_IBM_CLUB%7ESite_support.html">Donations</a>
<br />
<hr class='sep' /><strong><a href="../../../c/u/r/Current_methods.html" title="Current methods">编辑本页</a></strong>
<br /><a href="../../../c/u/r/Talk%7ECurrent_methods.html" class="new" title="Talk:Current methods">讨论本页</a>
<br /><a href="../../../c/u/r/Current_methods.html" title="Current methods">较早版本</a>
<br /><a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a>
<br /><a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><hr class='sep' /><a href="../../../s/p/e/Special%7ESpecialpages.html" title="Special:Specialpages">特殊页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E9%94%99%E8%AF%AF%E6%8A%A5%E5%91%8A.html" title="Wikipedia:错误报告">错误报告</a>
<br /></div>
<!-- Served by dns.cs.hit.edu.cn in 1351393217.59 secs. -->
</body></html>