<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn" >
<head>
<title>Linuxrc - WIKI-HIT IBM CLUB</title>
<meta name="KEYWORDS" content="首页,ALP,Address,Android,Android Newbie Guide,Android Project Development,Android Research Field,Android Third Party Lib And Tool,BoardGame,CSAPP" />
<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
<meta name="robots" content="index,follow" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../../../../skins/common/wikiprintable.css' />
<script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
<style type='text/css'>
/*/*/ /*<![CDATA[*/
@import "../../../../skins/common/wikistandard.css";
@import "../../../s/t/a/MediaWiki%7EStandard.css.html";
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px; border-right: 1px solid gray; }
#article { margin-left: 152px; margin-right: 4px; }

/*]]>*/ /* */
</style>
</head>

<body bgcolor='#FFFFFF' onload=''>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
<td width='152' rowspan='1'>&nbsp;</td><td class="top" align='left' valign='top'>
<a href="../../../index.html" title="首页">首页</a> |
<a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> |
<a href="../../../l/i/n/Linuxrc.html" title="Linuxrc">编辑本页</a> |
<a href="../../../l/i/n/Linuxrc.html" title="Linuxrc">较早版本</a><p class='subtitle'><a href="../../../l/i/n/Linuxrc.html">可打印版</a> | <a href="../../../g/e/n/WIKI-HIT_IBM_CLUB%7EGeneral_disclaimer.html" title="WIKI-HIT IBM CLUB:General disclaimer">Disclaimers</a></p>
</td>
<td class="top" valign='top' align='right' nowrap='nowrap'>Not logged in
<br /><a href="../../../u/s/e/Special%7EUserlogin.html" title="Special:Userlogin">登录</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html" title="Wikipedia:帮助">帮助</a>
<br /><form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form></td></tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">Linuxrc</h1><p class='subtitle'>Wikipedia，自由的百科全书</p>
<p>Linuxrc文件如下 ：
</p>
<pre>           1.  /linuxrc
</pre>
<ol><li>!/bin/sh
</li></ol>
<p>PATH=<i></i>
</p><p>run() {
</p>
<pre>   local message
   if message="`$* 2>&amp;1`"
   then
</pre>
<p>	echo 'done'
</p>
<ol><li>	echo "$message"
</li></ol>
<pre>       return 0
   else
</pre>
<p>	echo 'failed'
	echo "$message"
</p>
<pre>       return 1
   fi
</pre>
<p>}
</p><p>echo -n 'Synchronizing time ........................................... '
run '/bin/ntpdate -b 129.125.35.10'
while [ $? -ne 0 ]; do
</p>
<pre>   sleep 10
   echo -n 'Synchronizing time ....................................... '
   run '/bin/ntpdate -b 129.125.35.10'
</pre>
<p>done
</p><p>echo -n 'Mounting /proc file system ................................... '
run '/bin/mount /proc'
while [&nbsp;! -f /proc/version ]
do
</p>
<pre>   sleep 10
   echo -n 'Mounting /proc file system................................ '
   run '/bin/mount /proc'
</pre>
<p>done
</p><p>echo -n 'Mounting /usr on medusa.chem.rug.nl .......................... '
run '/bin/mount /usr'
while [&nbsp;! -f /usr/linuxrc ]
do
</p>
<pre>   sleep 10
   echo -n 'Mounting /usr on medusa.chem.rug.nl ...................... '
   run '/bin/mount /usr'
</pre>
<p>done
</p><p>/usr/linuxrc
</p><p>cd /
echo -n 'Unmounting /usr from medusa.chem.rug.nl ...................... '
run '/bin/umount /usr'
while [ -f /usr/linuxrc ]
do
</p>
<pre>   sleep 10
   echo -n 'Unmounting /usr from medusa.chem.rug.nl .................. '
   run '/bin/umount /usr'
</pre>
<p>done
</p><p>cd /
echo -n 'Unmounting /proc ............................................. '
run '/bin/umount /proc'
while [ -f /proc/version ]
do
</p>
<pre>   sleep 10
   echo -n 'Unmounting /proc ......................................... '
   run '/bin/umount /proc'
</pre>
<p>done
</p><p><br />
	      2. /usr/linuxrc
</p>
<ol><li>!/bin/sh
</li></ol>
<p>echo 
echo 'Starting linuxrc'
echo
</p><p>PATH=/sbin:/bin:/usr/sbin:/usr/bin
LOG=/tmp/log
ROOT=/mnt
</p>
<ol><li> 
</li><li> Return a list of partitiontypes
</li><li>
</li></ol>
<p>partitions() {
</p>
<pre>   sfdisk -l /dev/hda |
   awk '
</pre>
<p>	BEGIN { first = 1; res = "" }
	/^\/dev\// { 
	    if ( first ) { first = 0; res = $7$8 } 
	    else { res = res":"$7$8 } } 
	END{ print res }'
}
</p>
<ol><li>
</li><li> Create the partitions
</li><li> (should be dependent on the size of the disk)
</li><li>
</li></ol>
<p>create_partitions() {
</p>
<pre>   echo 'Creating partition table ..................................... '
   if sfdisk -uM -D /dev/hda &lt;&lt;EOF &gt;&gt; $LOG 2&gt;&amp;1
</pre>
<p>,32,L
,7168,E
,0,0
,0,0
,128,L
,512,S
,256,L
,512,L
,,L
EOF
</p>
<pre>   then
</pre>
<p>	echo 'done'
	return 0
</p>
<pre>   else
</pre>
<p>	echo 'failed'
	return 1
</p>
<pre>   fi
</pre>
<p>}
</p>
<ol><li>
</li><li> Check if the paritions have been made already
</li><li>
</li></ol>
<p>check_partitions() {
</p>
<pre>   echo -n 'Checking partition table ..................................... '
   local CHECK=\
              "Linux:Extended:Empty:Empty:Linux:Linuxswap:Linux:Linux:Linux"
   if sfdisk -Vq /dev/hda &gt; /tmp/out 2&gt;&amp;1
   then
</pre>
<p>	if [ "`partitions`" = "$CHECK" ]
	then
	    echo 'done'
	    cat /tmp/out
	    return 0
	else
	    echo 'failed'
	    cat /tmp/out
	    return 1
	fi
</p>
<pre>   else
</pre>
<p>	echo 'failed'
	cat /tmp/out
	return 1
</p>
<pre>   fi
</pre>
<p>}
</p>
<ol><li>
</li><li> Is the filesystem been properly closed?
</li><li>
</li></ol>
<p>filesystem_state() {
</p>
<pre>   filesystem=$1
   if info="`tune2fs -l $filesystem 2&gt;&amp;1`"
   then
</pre>
<p>	echo "$info" |
	awk '/^Filesystem state:/ { print $3$4 }'
</p>
<pre>   else
</pre>
<p>	echo "witherrors"
</p>
<pre>   fi
</pre>
<p>}
</p><p>NEW_PARTITION_TABLE=""
NEW_PARTITIONS=""
</p>
<ol><li>
</li><li> 1. if partitions not already made, create them
</li><li>
</li></ol>
<p>if [ -f /usr/reset ]; then
</p>
<pre>   # Force disk repartition
   NEW_PARTITION_TABLE="true"
   create_partitions
</pre>
<p>fi
</p><p>while&nbsp;! check_partitions
do
</p>
<pre>   NEW_PARTITION_TABLE="true"
   create_partitions
</pre>
<p>done
</p>
<ol><li>
</li><li> 2. if new partions made or root, boot and /var not clean, format them
</li><li>
</li></ol>
<p>if [ "$NEW_PARTITION_TABLE" -o \
</p>
<pre>   "`filesystem_state /dev/hda1`"&nbsp;!= "clean" -o \
   "`filesystem_state /dev/hda5`"&nbsp;!= "clean" -o \
   "`filesystem_state /dev/hda7`"&nbsp;!= "clean" ]
</pre>
<p>then
</p><p>echo -n 'Creating boot file system .................................... '
NEW_PARTITIONS="true"
mke2fs -q /dev/hda1 &gt;&gt; $LOG 2&gt;&amp;1 
echo 'done'
</p><p>echo -n 'Creating root file system .................................... '
NEW_PARTITIONS="true"
mke2fs -q /dev/hda5 &gt;&gt; $LOG 2&gt;&amp;1 
echo 'done'
</p><p>echo -n 'Creating swap partition ...................................... '
NEW_PARTITIONS="true"
mkswap /dev/hda6 &gt;&gt; $LOG 2&gt;&amp;1 
echo 'done'
</p><p>echo -n 'Creating var file system ..................................... '
NEW_PARTITIONS="true"
mke2fs -q /dev/hda7 &gt;&gt; $LOG 2&gt;&amp;1 
echo 'done'
</p><p>fi
</p>
<ol><li>
</li><li> 3. if /tmp not clean or new created, format
</li><li>
</li></ol>
<p>if [ "$NEW_PARTITION_TABLE" -o \
</p>
<pre>   "`filesystem_state /dev/hda8`"&nbsp;!= "clean" ]
</pre>
<p>then
</p>
<pre>   echo -n 'Creating tmp file system ................................. '
   NEW_PARTITIONS="true"
   mke2fs -q /dev/hda8 &gt;&gt; $LOG 2&gt;&amp;1 
   echo 'done'
</pre>
<p>fi
</p>
<ol><li>
</li><li> 3a. if /scratch not clean of new created, format
</li><li>
</li></ol>
<p>if [ "$NEW_PARTITION_TABLE" -o \
</p>
<pre>   "`filesystem_state /dev/hda9`"&nbsp;!= "clean" ]
</pre>
<p>then
</p>
<pre>   echo -n 'Creating scratch file system ............................. '
   NEW_PARTITIONS="true"
   mke2fs -q /dev/hda9 &gt;&gt; $LOG 2&gt;&amp;1 
   echo 'done'
</pre>
<p>fi
</p>
<ol><li>
</li><li> 4. mount all partitions and if necessary, fill them with software
</li><li>
</li></ol>
<p>mount /dev/hda5 $ROOT
if [&nbsp;! -d $ROOT/boot ]; then mkdir -p -m 755 $ROOT/boot; fi
if [&nbsp;! -d $ROOT/var ]; then mkdir -p -m 755 $ROOT/var; fi
if [&nbsp;! -d $ROOT/tmp ]; then mkdir -p -m 1755 $ROOT/tmp; fi
if [&nbsp;! -d $ROOT/scratch ]; then mkdir -p -m 1755 $ROOT/scratch; fi
chmod 755 $ROOT/var $ROOT/boot 
chmod 1777 $ROOT/tmp $ROOT/scratch
mount /dev/hda1 $ROOT/boot
mount /dev/hda7 $ROOT/var
mount /dev/hda8 $ROOT/tmp
mount /dev/hda9 $ROOT/scratch
</p><p>fill_file_system() {
</p>
<pre>   echo -n 'Filling file system ...................................... '
   tar xzpCf $ROOT /usr/linux.tar.gz 
   date &gt; $ROOT/.stamp
   chmod 400 $ROOT/.stamp
   echo 'done'
</pre>
<p>}
</p><p>if [ $NEW_PARTITIONS ]
then
</p>
<pre>   fill_file_system
</pre>
<p>else
</p>
<pre>   if [&nbsp;! -f "$ROOT/.stamp" ]
   then
</pre>
<p>	fill_file_system
</p>
<pre>   else
</pre>
<p>	if [ "/usr/linux.tar.gz" -nt "$ROOT/.stamp" ]
	then
	    fill_file_system
	fi
</p>
<pre>   fi
</pre>
<p>fi
</p><p>&gt;/$ROOT/var/log/wtmp
</p><p>umount $ROOT/scratch
umount $ROOT/tmp
umount $ROOT/var
umount $ROOT/boot
umount $ROOT
</p><p>echo 
echo 'Leaving linuxrc'
echo
</p><p><br />
</p><p><br />
		3. /etc/rc.d/rc.client
</p>
<ol><li>! /bin/sh
</li></ol>
<p>PATH="/bin:/sbin"
umask 077
</p>
<ol><li> prevent problems later:
</li></ol>
<p>chmod 1777 /tmp /scratch
</p>
<ol><li>
</li><li> FIRST: WHO AM I
</li><li> This will be asked from some bootp server and stored in
</li><li> /etc/default/network
</li><li>
</li></ol>
<p>if [&nbsp;! -L /etc/default/network ]
then
</p>
<pre>   ln -sf /etc/config/network /etc/default/network
</pre>
<p>fi
</p><p>if [&nbsp;! -f /etc/default/network ]
then
</p>
<pre>   bootpc --waitformore 5 &gt; /etc/default/network
   chmod 444 /etc/default/network
</pre>
<p>fi
</p><p>. /etc/default/network
</p>
<ol><li>
</li><li> 1. Configure network
</li><li>
</li><li> 1.1. edit /etc/sysconfig/network
</li><li>
</li></ol>
<p>FILE="/etc/sysconfig/network"
OLDFILE="$FILE~" NEWFILE="${FILE%/*}/#${FILE##*/}#"
sed -e 's|^HOSTNAME=.*$|HOSTNAME='$HOSTNAME'|' \
</p>
<pre>   -e 's|^GATEWAY=.*$|GATEWAY='$GATEWAYS_1'|' &lt; $FILE &gt; $NEWFILE
</pre>
<p>cp -p $FILE $OLDFILE &amp;&amp; mv $NEWFILE $FILE
chmod 444 $FILE $OLDFILE
</p>
<ol><li>
</li><li> 1.2. edit /etc/sysconfig/network-scripts/ifcfg-eth0
</li><li>
</li></ol>
<p>FILE="/etc/sysconfig/network-scripts/ifcfg-eth0"
OLDFILE="$FILE~" NEWFILE="${FILE%/*}/#${FILE##*/}#"
sed -e 's|^IPADDR=.*$|IPADDR='$IPADDR'|' \
</p>
<pre>   -e 's|^NETMASK=.*$|NETMASK='$NETMASK'|' &lt; $FILE &gt; $NEWFILE
</pre>
<p>cp -p $FILE $OLDFILE &amp;&amp; mv $NEWFILE $FILE
chmod 444 $FILE $OLDFILE
</p>
<ol><li>
</li><li> 2. configure time
</li><li>
</li><li> 2.1. create /etc/ntp/step-tickers
</li><li>
</li></ol>
<p>FILE="/etc/ntp/step-tickers"
echo "$TIMESRVS_1" &gt; $FILE
chmod 444 $FILE
</p>
<ol><li>
</li><li> 2.2. edit /etc/ntp.conf
</li><li>
</li></ol>
<p>FILE="/etc/ntp.conf"
OLDFILE="$FILE~" NEWFILE="${FILE%/*}/#${FILE##*/}#"
sed -e 's|^\(server.*\)$|#\1|' \
</p>
<pre>   -e 's|^\(fudge.*\)$|#\1|' &lt; $FILE &gt; $NEWFILE
</pre>
<p>cat &gt;&gt; $NEWFILE &lt;&lt;EOF
</p><p>server $TIMESRVS_1
EOF
cp -p $FILE $OLDFILE &amp;&amp; mv $NEWFILE $FILE
chmod 444 $FILE $OLDFILE
</p>
<ol><li>
</li><li> 2.3. and initialise the clock
</li><li>
</li></ol>
<p>if [ -f /etc/ntp/step-tickers ]; then
</p>
<pre>   echo -n "Syncing time for xntpd. "
   if /sbin/ntpdate -s -b -p 8 -u `cat /etc/ntp/step-tickers`; then
       echo
</pre>
<p>	echo -n "Syncing hardwareclock with systemclock. "
	/sbin/hwclock --utc --systohc
</p>
<pre>   fi
   echo
</pre>
<p>fi
</p>
<ol><li>
</li><li> 3. Disable some services 
</li><li>
</li></ol>
<p>/sbin/chkconfig dhcpd off
if [ -f /etc/exports ]; then rm /etc/exports; fi
</p>
<ol><li>
</li><li> 4. Install a /etc/lilo.conf
</li><li>
</li></ol>
<p>INFILE="/lib/config/lilo.conf"
FILE="/etc/lilo.conf"
OLDFILE="$FILE~" NEWFILE="${FILE%/*}/#${FILE##*/}#"
sed -e 's|IPADDR|'$IPADDR'|' &lt; $INFILE &gt; $NEWFILE
cp -p $FILE $OLDFILE &amp;&amp; mv $NEWFILE $FILE
chmod 444 $FILE $OLDFILE
</p><p>mv -f /boot/vmlinuz.install /boot/vmlinuz
mv -f /boot/ramdisk.gz.install /boot/ramdisk.gz
/sbin/lilo
sync
</p>
<ol><li>/sbin/freeramdisk
</li></ol>

<div class="printfooter">
<p>取自"<a href="http://dns.cs.hit.edu.cn../../../l/i/n/Linuxrc.html">http://dns.cs.hit.edu.cn../../../l/i/n/Linuxrc.html</a>"</p>

<p>本页面已经被浏览12次。 This page was last modified 09:06 2006年3月25日 by <a href="../../../s/i/m/User%7ESimple.html" class="new" title="User:Simple">徐兴鹏</a>.  </p>
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'><strong><a href="../../../l/i/n/Linuxrc.html" title="Linuxrc">编辑本页</a></strong> |
<a href="../../../l/i/n/Talk%7ELinuxrc.html" class="new" title="Talk:Linuxrc">讨论本页</a> |
<a href="../../../l/i/n/Linuxrc.html" title="Linuxrc">较早版本</a> |
<a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a> |
<a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><br />

<br /><a href="../../../index.html" title="首页">首页</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%85%B3%E4%BA%8E.html" title="Wikipedia:关于">关于Wikipedia</a> | <a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> | <form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form><br /><span id="pagestats">本页面已经被浏览12次。 This page was last modified 09:06 2006年3月25日 by <a href="../../../s/i/m/User%7ESimple.html" class="new" title="User:Simple">徐兴鹏</a>.  </span></td></tr></table>
</div>
</div>

<div id='quickbar'>
<a href='../../../index.html'><img src='../../../../skins/common/images/wiki.jpg' alt='[首页]' /></a>
<hr class='sep' /><a href="../../../index.html">首页</a>
<br /><a href="../../../c/o/m/WIKI-HIT_IBM_CLUB%7ECommunity_Portal_9150.html">社区</a>
<br /><a href="../../../c/u/r/Current_events.html">新闻动态</a>
<br /><a href="../../../r/e/c/Special%7ERecentchanges.html">最近更改</a>
<br /><a href="../../../r/a/n/Special%7ERandom.html">随机页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html">帮助</a>
<br /><a href="../../../s/i/t/WIKI-HIT_IBM_CLUB%7ESite_support.html">Donations</a>
<br />
<hr class='sep' /><strong><a href="../../../l/i/n/Linuxrc.html" title="Linuxrc">编辑本页</a></strong>
<br /><a href="../../../l/i/n/Talk%7ELinuxrc.html" class="new" title="Talk:Linuxrc">讨论本页</a>
<br /><a href="../../../l/i/n/Linuxrc.html" title="Linuxrc">较早版本</a>
<br /><a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a>
<br /><a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><hr class='sep' /><a href="../../../s/p/e/Special%7ESpecialpages.html" title="Special:Specialpages">特殊页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E9%94%99%E8%AF%AF%E6%8A%A5%E5%91%8A.html" title="Wikipedia:错误报告">错误报告</a>
<br /></div>
<!-- Served by dns.cs.hit.edu.cn in 1351392663.60 secs. -->
</body></html>