<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn" >
<head>
<title>EasyMock使用说明 - WIKI-HIT IBM CLUB</title>
<meta name="KEYWORDS" content="首页,ALP,Address,Android,Android Newbie Guide,Android Project Development,Android Research Field,Android Third Party Lib And Tool,BoardGame,CSAPP" />
<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
<meta name="robots" content="index,follow" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../../../../skins/common/wikiprintable.css' />
<script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
<style type='text/css'>
/*/*/ /*<![CDATA[*/
@import "../../../../skins/common/wikistandard.css";
@import "../../../s/t/a/MediaWiki%7EStandard.css.html";
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px; border-right: 1px solid gray; }
#article { margin-left: 152px; margin-right: 4px; }

/*]]>*/ /* */
</style>
</head>

<body bgcolor='#FFFFFF' onload=''>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
<td width='152' rowspan='1'>&nbsp;</td><td class="top" align='left' valign='top'>
<a href="../../../index.html" title="首页">首页</a> |
<a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> |
<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑本页</a> |
<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">较早版本</a><p class='subtitle'><a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html">可打印版</a> | <a href="../../../g/e/n/WIKI-HIT_IBM_CLUB%7EGeneral_disclaimer.html" title="WIKI-HIT IBM CLUB:General disclaimer">Disclaimers</a></p>
</td>
<td class="top" valign='top' align='right' nowrap='nowrap'>Not logged in
<br /><a href="../../../u/s/e/Special%7EUserlogin.html" title="Special:Userlogin">登录</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html" title="Wikipedia:帮助">帮助</a>
<br /><form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form></td></tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">EasyMock使用说明</h1><p class='subtitle'>Wikipedia，自由的百科全书</p>
<table id='toc' class='toc'><tr><td><div id='toctitle'><h2>目录</h2></div>
<ul>
<li class='toclevel-1'><a href="#.E5.BC.80.E5.8F.91.E7.8E.AF.E5.A2.83.E7.89.88.E6.9C.AC"><span class="tocnumber">1</span> <span class="toctext">开发环境版本</span></a></li>
<li class='toclevel-1'><a href="#EasyMock.E4.BB.8B.E7.BB.8D"><span class="tocnumber">2</span> <span class="toctext">EasyMock介绍</span></a></li>
<li class='toclevel-1'><a href="#.E4.B8.8B.E8.BD.BD.E5.8F.8A.E5.AE.89.E8.A3.85"><span class="tocnumber">3</span> <span class="toctext">下载及安装</span></a></li>
<li class='toclevel-1'><a href="#.E6.A6.82.E5.BF.B5.E5.87.86.E5.A4.87"><span class="tocnumber">4</span> <span class="toctext">概念准备</span></a>
<ul>
<li class='toclevel-2'><a href="#method.E3.80.81arguments.EF.BC.8Cinvocation"><span class="tocnumber">4.1</span> <span class="toctext">method、arguments，invocation</span></a></li>
<li class='toclevel-2'><a href="#ExpectedInvocation.EF.BC.8Cactual"><span class="tocnumber">4.2</span> <span class="toctext">ExpectedInvocation，actual</span></a></li>
<li class='toclevel-2'><a href="#MockControl.E3.80.81Mock"><span class="tocnumber">4.3</span> <span class="toctext">MockControl、Mock</span></a></li>
<li class='toclevel-2'><a href="#reset.28.29.E3.80.81replay.28.29.E3.80.81verify.28.29"><span class="tocnumber">4.4</span> <span class="toctext">reset()、replay()、verify()</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="#.E6.B5.8B.E8.AF.95.E7.BB.93.E6.9E.84.E6.A8.A1.E5.9E.8B"><span class="tocnumber">5</span> <span class="toctext">测试结构模型</span></a>
<ul>
<li class='toclevel-2'><a href="#.E6.8E.A5.E5.8F.A3.E7.B1.BB.EF.BC.9ABaseInterface"><span class="tocnumber">5.1</span> <span class="toctext">接口类：BaseInterface</span></a></li>
<li class='toclevel-2'><a href="#.E5.AE.9E.E4.BD.93.E7.B1.BB.EF.BC.9AImplementsBaseInterface.E3.80.81TargetClass"><span class="tocnumber">5.2</span> <span class="toctext">实体类：ImplementsBaseInterface、TargetClass</span></a></li>
<li class='toclevel-2'><a href="#.E7.B1.BB.E5.8F.8A.E6.96.B9.E6.B3.95.E4.B9.8B.E9.97.B4.E7.9A.84.E5.85.B3.E7.B3.BB"><span class="tocnumber">5.3</span> <span class="toctext">类及方法之间的关系</span></a></li>
<li class='toclevel-2'><a href="#.E6.B5.8B.E8.AF.95.E7.B1.BB.EF.BC.9ATargetClassTest"><span class="tocnumber">5.4</span> <span class="toctext">测试类：TargetClassTest</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="#.E5.AF.B9.E4.BA.8E.E6.A8.A1.E5.9E.8B.E7.9A.84.E8.AF.B4.E6.98.8E"><span class="tocnumber">6</span> <span class="toctext">对于模型的说明</span></a>
<ul>
<li class='toclevel-2'><a href="#control"><span class="tocnumber">6.1</span> <span class="toctext">control</span></a></li>
<li class='toclevel-2'><a href="#andReturn.28.29"><span class="tocnumber">6.2</span> <span class="toctext">andReturn()</span></a></li>
<li class='toclevel-2'><a href="#mock.E7.9A.84.E7.A7.8D.E7.B1.BB"><span class="tocnumber">6.3</span> <span class="toctext">mock的种类</span></a></li>
<li class='toclevel-2'><a href="#.E4.B8.80.E7.82.B9.E8.A1.A5.E5.85.85"><span class="tocnumber">6.4</span> <span class="toctext">一点补充</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="#.E6.9D.82.E8.B0.88EasyMock.E5.86.85.E9.83.A8.E5.8E.9F.E7.90.86"><span class="tocnumber">7</span> <span class="toctext">杂谈EasyMock内部原理</span></a></li>
</ul>
</td></tr></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "显示"; var tocHideText = "隐藏"; showTocToggle(); } </script>
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name=".E5.BC.80.E5.8F.91.E7.8E.AF.E5.A2.83.E7.89.88.E6.9C.AC"></a><h2>开发环境版本</h2>
<table>
<tr>
<td>JDK</td><td>1.5
</td></tr>
<tr>
<td>JUnit</td><td>3.8
</td></tr>
<tr>
<td>EasyMock</td><td>2.2
</td></tr>
<tr>
<td>Eclipse</td><td>3.1.2
</td></tr>
<tr>
<td>MyEclipse</td><td>4.1.0
</td></tr></table>
<p>注：EasyMock2.0+只支持JDK1.5+，因为其代码中用到了很多新增特性，比如for(:)、method(...)等用法。EasyMock最初的1.0版本似乎支持对实体类的模拟，但是貌似在很面的版本中和快就取消了这个功能。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name="EasyMock.E4.BB.8B.E7.BB.8D"></a><h2>EasyMock介绍</h2>
<p><a href="http://www.easymock.org/" class='external text' title="http://www.easymock.org/" rel="nofollow">EasyMock官方页面</a>
</p><p>EasyMock provides Mock Objects for interfaces in JUnit tests by generating them on the fly using Java's proxy mechanism. Due to EasyMock's unique style of recording expectations, most refactorings will not affect the Mock Objects. So EasyMock is a perfect fit for Test-Driven Development.
</p><p>EasyMock是用于JUnit中的虚拟测试辅助包，它提供对interface类的模拟，能够通过录制、回放、检查三步来完成大体的测试过程，可以验证方法的调用种类、次数、顺序，可以令mock对象返回指定的值或抛出指定异常。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name=".E4.B8.8B.E8.BD.BD.E5.8F.8A.E5.AE.89.E8.A3.85"></a><h2>下载及安装</h2>
<p>EasyMock是放在<a href="http://sourceforge.net/" class='external text' title="http://sourceforge.net/" rel="nofollow">sourceforge</a>上的一个<a href="http://sourceforge.net/projects/easymock" class='external text' title="http://sourceforge.net/projects/easymock" rel="nofollow">开源项目</a>，可以自由下载，从那里下载到对应版本的压缩包后可以直接解压，对于开发，我们只需要easymock.jar这个文件，把它添加到Eclipse的项目jar库里就可以使用了。
</p><p>另外，由于它是用于在JUnit环境下测试的包，所以在实际使用的时候还需要添加JUnit.jar
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name=".E6.A6.82.E5.BF.B5.E5.87.86.E5.A4.87"></a><h2>概念准备</h2>
<p>在正式编程之前，还需要搞懂一些相关概念，这些有的也是类的名字，但是在这里主要是理解他所代表的概念，方便进一步使用EasyMock。
</p>
<pre>Method、Arguments、Invocation
ExpectedInvocation、actual
MockControl、Mock
reset()、replay()、verify()等。
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name="method.E3.80.81arguments.EF.BC.8Cinvocation"></a><h3>method、arguments，invocation</h3>
<p>这三个概念有从属关系，method代表要模拟的类的一个方法，arguments是这个方法的入口参数，invocation代表一次模拟类的某个方法的调用，它包含一个method，若干argument（但是在这里不包括返回值）。在EasyMock中有Invocation这个类，含有Object[] arguments、Method method、Object mock参数。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name="ExpectedInvocation.EF.BC.8Cactual"></a><h3>ExpectedInvocation，actual</h3>
<p>前者是代表一次预期的方法调用，这里的预期是指加入了Matcher(s)的Invocation，不仅要具有Invocation的特征，还要加上对其入口参数的检验器（Matcher），这一概念的引入是为了保证可以判断类似数组这种对象的比较关系，或者为入口参数设定合法条件（不仅是简单的相等，还有大于等于，字符串的endwith等，用户只要按照它的规则，也可以自己制作专门的matcher）。与其相关的类有ExpectedInvocation、ExpectedInvocationAndResult、ExpectedInvocationAndResults，后面两个类加入了指定的返回值，是对有返回值的函数适用的。
</p><p>而后面的actual是经常出现在EasyMock源代码中作为参数使用的单词，用于代表replay过程中的一次实际的方法调用，和Invocation属于一种概念。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name="MockControl.E3.80.81Mock"></a><h3>MockControl、Mock</h3>
<p>MockControl是控制类，他负责建立整个框架所需的资源，其成员behavior和RecordState state用于保存方法调用的序列，一个control可以同时管理多个mock。Mock对象对应一个你需要测试的待测试类，它会自动建立JavaProxyFactory&lt;toMock&gt;,再由JavaProxyFactory建立Proxy；同时建立的还有ObjectMethodFilter（他持有一个MockInvocationHandler对象，对hashCode()、equals()、toString()三个方法进行判断）和MockInvocationHandler（他持有一个control对象，似乎是用于添加Invocation序列的）。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name="reset.28.29.E3.80.81replay.28.29.E3.80.81verify.28.29"></a><h3>reset()、replay()、verify()</h3>
<p>reset()方法是将control对象复位，其内部现实是靠新建behavior和state两个对象完成的。replay()是结束录制过程，他会调用RecordState.closeMethod()方法来完成大部分工作。verify()是用于在录制和回放两个步骤完成之后进行预期和实际结果的检查。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name=".E6.B5.8B.E8.AF.95.E7.BB.93.E6.9E.84.E6.A8.A1.E5.9E.8B"></a><h2>测试结构模型</h2>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name=".E6.8E.A5.E5.8F.A3.E7.B1.BB.EF.BC.9ABaseInterface"></a><h3>接口类：BaseInterface</h3>
<pre>public interface BaseInterface{
  public void methodABC();
  public SomeValue methodABC(SomeArgument someArgument);
} 
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name=".E5.AE.9E.E4.BD.93.E7.B1.BB.EF.BC.9AImplementsBaseInterface.E3.80.81TargetClass"></a><h3>实体类：ImplementsBaseInterface、TargetClass</h3>
<pre>ImplementsBaseInterface继承了BaseInterface接口，提供方法的具体实现。
</pre>
<pre>public class TargetClass{
  private BaseInterface  member;
  ……//其他成员
  public void somMethods(){
     ……
     member.methodABC();
     member.methodABC(someArguments，……);
  }
  public void setMemeber(BaseInterface  member){
      this.memeber = member;
  }
  ……//其他方法
}
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name=".E7.B1.BB.E5.8F.8A.E6.96.B9.E6.B3.95.E4.B9.8B.E9.97.B4.E7.9A.84.E5.85.B3.E7.B3.BB"></a><h3>类及方法之间的关系</h3>
<p>而TargetClass可能会有一些内部成员，比如现在我们正好有一个BaseInterface类型的内部成员member，而TargetClass正好有someMethods()需要调用到BaseInterface中的methodABC()和methodABC(SomeArgument someArgument)。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name=".E6.B5.8B.E8.AF.95.E7.B1.BB.EF.BC.9ATargetClassTest"></a><h3>测试类：TargetClassTest</h3>
<p>TargetClassTest是一个JUnit Test Case类，用于测试TargetClass这个类，这是我们的目的。
</p>
<pre>import static org.easymock.EasyMock.*;
import  ……
public class TargetClassTest{
   private TargetClass target;
   private BaseInterface  mock;
   private IMocksControl ctrl;
   public void setUp(){
       ctrl = createStrictControl();
       mock = ctrl.createMock( ImplementsBaseInterface.class ); //建立easymock测试类
       target = new TargetClass();
       target.setMember(mock);   //将刚刚建立的mock加入到target的成员中
   }
   public void testSomeMethods() throws Exception{
       ……//准备工作，生成一些将要使用的对象
       ctrl.reset();  //初始化
       mock.methodABC();
       expect(mock.methodABC(someArguments，……)).andReturn(SomeValue); //由于这个方法有返回值，所以需要用andReturn()方法来指定，否则测试的时候会扔出异常
       ctrl.replay();  //结束整个control的recorder过程，下面进入回放
       target.someMethods();
       ctrl.verify();  //结束回放，进行检查，主要检查回放过程和录制过程是否一致，对于mock对象的方法调用种类、数量、顺序是否符合要求进行验证。如果有错误出现就会抛出异常，但是没有自动检查返回值的功能。
   }
}
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name=".E5.AF.B9.E4.BA.8E.E6.A8.A1.E5.9E.8B.E7.9A.84.E8.AF.B4.E6.98.8E"></a><h2> 对于模型的说明 </h2>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name="control"></a><h3>control</h3>
<p>当只有一个mock对象的时候，我们也可以不手动生成control对象，而是直接调用EasyMock类中的createMock(Class clazz)方法，这样的话，相应的reset()、replay()、verify()方法也不能使用control的，而要使用EasyMock类中的reset(mock)、replay(mock)、verify(mock)方法，只对单一的一个mock对象进行操作，在有多个mock对象的时候可以做到异步操作（但是这样做似乎意义不大）。但是实际上，control对象是一定会生成的，无论你是否手动生成。
</p><p>生成control对象的好处在于当有多个mock的时候可以一起执行reset()、replay()、verify()操作。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name="andReturn.28.29"></a><h3>andReturn()</h3>
<p>这个方法只是用于当mock对象的方法需要有返回值的情况下，手动设置这个方法的返回值给调用的测试类的。在本例中methodABC(arguments,……)方法就需要在recorder的时候用andReturn()方法指定返回值给TargetClass。如果对于有返回值的方法不指定其返回值，在测试的时候会抛出"java.lang.IllegalStateException: missing behavior definition for the preceeding method call XXX"异常。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name="mock.E7.9A.84.E7.A7.8D.E7.B1.BB"></a><h3>mock的种类</h3>
<p>EasyMock提供了三种Mock类型：StrictMock、NiceMock、Mock。
</p>
<table border="1px">
<tr>
<td>种类</td><td>生成函数</td><td>检查顺序</td><td>检查方法是否调用</td><td>对未说明的方法调用
</td></tr>
<tr>
<td>Mock</td><td>createMock()</td><td>否</td><td>是</td><td>抛出异常
</td></tr>
<tr>
<td>NiceMock</td><td>createNiceMock()</td><td>否</td><td>是</td><td>返回0、null，不抛出异常
</td></tr>
<tr>
<td>StrictMock</td><td>createStrictMock()</td><td>是</td><td>是</td><td>抛出异常
</td></tr></table>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name=".E4.B8.80.E7.82.B9.E8.A1.A5.E5.85.85"></a><h3>一点补充</h3>
<p>对于recorder期的方法调用还有一些设定调用次数的方法比较重要，可能会用到，比如说times()，可以设定调用出现的次数使用方法类似andReturn(value)
</p>
<pre>expect(***).times(3); //指定这个方法调用出现三次
</pre>
<p>相当于
</p>
<pre>expect(***);
expect(***);
expect(***);
</pre>
<p>还可以设定它出现的次数为不封顶，或在一个范围之内，这些方法都可以在MocksControl类中找到
</p>
<pre>times(int);
times(min , max);  //将max设为整数最大值就是不封顶，其实设大点也就够用了
anyTimes();
once();
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑</a>]</div><a name=".E6.9D.82.E8.B0.88EasyMock.E5.86.85.E9.83.A8.E5.8E.9F.E7.90.86"></a><h2>杂谈EasyMock内部原理</h2>
<p>看了一天半的时间，对他的原理有了一些认识，但是还不全面，对一些深层的原理还了解得不太清楚，先简单谈一谈目前的认识，很可能会有很多错误的地方，如果以后发现，会陆续修改。
</p><p><br />
EasyMock是利用线程来捕获mock对象函数调用的，所以他特别有一个LastControl类，里面有三个成员，
用于将线程与三个不同的类相关联，matcher是匹配器、argument是入口参数、control中含有大部分主要内容。
</p>
<pre> private static final WeakHashMap&lt;Thread, MocksControl&gt; threadToControl 
 = new WeakHashMap&lt;Thread, MocksControl&gt;();
</pre>
<pre> private static final WeakHashMap&lt;Thread, Stack&lt;Object[]&gt;&gt; threadToCurrentArguments
 = new WeakHashMap&lt;Thread, Stack&lt;Object[]&gt;&gt;();
</pre>
<pre> private static final WeakHashMap&lt;Thread, Stack&lt;IArgumentMatcher&gt;&gt; threadToArgumentMatcherStack
 = new WeakHashMap&lt;Thread, Stack&lt;IArgumentMatcher&gt;&gt;();
</pre>
<pre>困惑：matcher和argument应该都是和指定的Invocation相关联，但是这里只存了control，而一个control可以有多个mock，一个mock又能有多个method过程，怎样确定matcher、argument和method的对应关系？是通过线程实现的么？
</pre>
<p><br />
他将recorder到的method及其参数、times都记录到线性表中，而replay的对应method、参数、times也都记录下来，进行对比，从而实现verify()功能。
</p><p><br />
Invocation对应一次具体的方法调用过程，可能包含返回值Result。
</p><p><br />
与之对应的ExpectedInvocation系列类加入了matcher和result，也就是加入了预期的功能。
</p><p><br />
UnorderedBehavior是最底层的Behavior类，其中主要有addExpected()和addActual()两个方法，应该可以完成预期的保存和检验两个功能。他有一个ExpectedInvocationAndResults的List，可以记录一些列的方法预期，可以指定应记录一个mock，但是这点还没有证实。
</p><p><br />
recorder和replay都是主要靠IMocksControlState接口的实现类：RecorderState和ReplayState，各司其职。
</p><p><br />
RecorderState的成员是：ExpectedInvocation lastInvocation、Result lastResult、IMocksBehavior behavior
behavior用于记录所有提交进来的ExpectedInvocation，而那两个lastXXX，应该是用于保留最后一条记录。verify()方法会直接抛出异常：calling verify is not allowed in record state
</p><p><br />
ReplayState只有一个IMocksBehavior behavior成员，方法也只有invoke()和verify()不会直接抛出异常。应该是像其名称一样专门用于处理replay时期的验证的。
</p>
<div class="printfooter">
<p>取自"<a href="http://dns.cs.hit.edu.cn../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html">http://dns.cs.hit.edu.cn../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html</a>"</p>

<p>本页面已经被浏览37次。 This page was last modified 12:54 2006年7月21日 by <a href="../../../d/y/i/User%7EDyingcow.html" title="User:Dyingcow">刘奭</a>.  </p>
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'><strong><a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑本页</a></strong> |
<a href="../../../e/a/s/Talk%7EEasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_beaa.html" class="new" title="Talk:EasyMock使用说明">讨论本页</a> |
<a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">较早版本</a> |
<a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a> |
<a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><br />

<br /><a href="../../../index.html" title="首页">首页</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%85%B3%E4%BA%8E.html" title="Wikipedia:关于">关于Wikipedia</a> | <a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> | <form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form><br /><span id="pagestats">本页面已经被浏览37次。 This page was last modified 12:54 2006年7月21日 by <a href="../../../d/y/i/User%7EDyingcow.html" title="User:Dyingcow">刘奭</a>.  </span></td></tr></table>
</div>
</div>

<div id='quickbar'>
<a href='../../../index.html'><img src='../../../../skins/common/images/wiki.jpg' alt='[首页]' /></a>
<hr class='sep' /><a href="../../../index.html">首页</a>
<br /><a href="../../../c/o/m/WIKI-HIT_IBM_CLUB%7ECommunity_Portal_9150.html">社区</a>
<br /><a href="../../../c/u/r/Current_events.html">新闻动态</a>
<br /><a href="../../../r/e/c/Special%7ERecentchanges.html">最近更改</a>
<br /><a href="../../../r/a/n/Special%7ERandom.html">随机页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html">帮助</a>
<br /><a href="../../../s/i/t/WIKI-HIT_IBM_CLUB%7ESite_support.html">Donations</a>
<br />
<hr class='sep' /><strong><a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">编辑本页</a></strong>
<br /><a href="../../../e/a/s/Talk%7EEasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_beaa.html" class="new" title="Talk:EasyMock使用说明">讨论本页</a>
<br /><a href="../../../e/a/s/EasyMock%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E_5a8e.html" title="EasyMock使用说明">较早版本</a>
<br /><a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a>
<br /><a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><hr class='sep' /><a href="../../../s/p/e/Special%7ESpecialpages.html" title="Special:Specialpages">特殊页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E9%94%99%E8%AF%AF%E6%8A%A5%E5%91%8A.html" title="Wikipedia:错误报告">错误报告</a>
<br /></div>
<!-- Served by dns.cs.hit.edu.cn in 1351392861.65 secs. -->
</body></html>