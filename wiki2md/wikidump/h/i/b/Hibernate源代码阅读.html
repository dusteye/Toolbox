<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn" >
<head>
<title>Hibernate源代码阅读 - WIKI-HIT IBM CLUB</title>
<meta name="KEYWORDS" content="首页,ALP,Address,Android,Android Newbie Guide,Android Project Development,Android Research Field,Android Third Party Lib And Tool,BoardGame,CSAPP" />
<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
<meta name="robots" content="index,follow" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../../../../skins/common/wikiprintable.css' />
<script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
<style type='text/css'>
/*/*/ /*<![CDATA[*/
@import "../../../../skins/common/wikistandard.css";
@import "../../../s/t/a/MediaWiki%7EStandard.css.html";
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px; border-right: 1px solid gray; }
#article { margin-left: 152px; margin-right: 4px; }

/*]]>*/ /* */
</style>
</head>

<body bgcolor='#FFFFFF' onload=''>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
<td width='152' rowspan='1'>&nbsp;</td><td class="top" align='left' valign='top'>
<a href="../../../index.html" title="首页">首页</a> |
<a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> |
<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑本页</a> |
<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">较早版本</a><p class='subtitle'><a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html">可打印版</a> | <a href="../../../g/e/n/WIKI-HIT_IBM_CLUB%7EGeneral_disclaimer.html" title="WIKI-HIT IBM CLUB:General disclaimer">Disclaimers</a></p>
</td>
<td class="top" valign='top' align='right' nowrap='nowrap'>Not logged in
<br /><a href="../../../u/s/e/Special%7EUserlogin.html" title="Special:Userlogin">登录</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html" title="Wikipedia:帮助">帮助</a>
<br /><form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form></td></tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">Hibernate源代码阅读</h1><p class='subtitle'>Wikipedia，自由的百科全书</p>
<table id='toc' class='toc'><tr><td><div id='toctitle'><h2>目录</h2></div>
<ul>
<li class='toclevel-1'><a href="#.E6.A6.82.E8.BF.B0"><span class="tocnumber">1</span> <span class="toctext">概述</span></a></li>
<li class='toclevel-1'><a href="#Cache"><span class="tocnumber">2</span> <span class="toctext">Cache</span></a>
<ul>
<li class='toclevel-2'><a href="#.E6.A6.82.E8.BF.B0_2"><span class="tocnumber">2.1</span> <span class="toctext">概述</span></a></li>
<li class='toclevel-2'><a href="#Cache_2"><span class="tocnumber">2.2</span> <span class="toctext">Cache</span></a></li>
<li class='toclevel-2'><a href="#CacheFactory"><span class="tocnumber">2.3</span> <span class="toctext">CacheFactory</span></a></li>
<li class='toclevel-2'><a href="#CacheConcurrencyStrategy"><span class="tocnumber">2.4</span> <span class="toctext">CacheConcurrencyStrategy</span></a></li>
<li class='toclevel-2'><a href="#CacheProvider"><span class="tocnumber">2.5</span> <span class="toctext">CacheProvider</span></a></li>
<li class='toclevel-2'><a href="#Timestamper"><span class="tocnumber">2.6</span> <span class="toctext">Timestamper</span></a></li>
<li class='toclevel-2'><a href="#others"><span class="tocnumber">2.7</span> <span class="toctext">others</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="#cfg"><span class="tocnumber">3</span> <span class="toctext">cfg</span></a>
<ul>
<li class='toclevel-2'><a href="#.E6.A6.82.E8.BF.B0_3"><span class="tocnumber">3.1</span> <span class="toctext">概述</span></a></li>
<li class='toclevel-2'><a href="#NamingStrategy"><span class="tocnumber">3.2</span> <span class="toctext">NamingStrategy</span></a></li>
<li class='toclevel-2'><a href="#Environment"><span class="tocnumber">3.3</span> <span class="toctext">Environment</span></a></li>
<li class='toclevel-2'><a href="#Settings"><span class="tocnumber">3.4</span> <span class="toctext">Settings</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="#odmg"><span class="tocnumber">4</span> <span class="toctext">odmg</span></a>
<ul>
<li class='toclevel-2'><a href="#Database"><span class="tocnumber">4.1</span> <span class="toctext">Database</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="#collection"><span class="tocnumber">5</span> <span class="toctext">collection</span></a></li>
</ul>
</td></tr></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "显示"; var tocHideText = "隐藏"; showTocToggle(); } </script>
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name=".E6.A6.82.E8.BF.B0"></a><h2>概述</h2>
<p>本次阅读的Hibernate源代码版本是2.1
</p><p><font color="red">注：package base = net.sf.hibernate</font>
</p><p>包总体结果说明
</p>
<table border="1">
<tr>
<td colspan="2" align="center"><b>核心API</b>
</td></tr>
<tr>
<th>包名（net.sf.hibernate）</th><th>作用
</th></tr>
<tr>
<td> - </td><td>最主要的一些对外接口、类，比较杂
</td></tr>
<tr>
<td>cfg</td><td>Hibernate环境参数配置管理相关类，用于处理.properties、xml等环境参数配置文件。
</td></tr></table>
<p><a href="../../../h/i/b/Hibernate_SVN_fddf.html" title="Hibernate SVN">Hibernate SVN</a>
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="Cache"></a><h2> <i>Cache</i> </h2> <div>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name=".E6.A6.82.E8.BF.B0_2"></a><h3>概述</h3>
<pre>主要接口类：Cache、CacheConcurrencyStrategy、CacheProvider
主要实体类：CacheFactory、Timestamper 
</pre>
</div>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="Cache_2"></a><h3> Cache </h3>
<p>规定了get、remove、put、clear、destroy、lock/unlock、
nextTimestamp、getTimeout几个方法，并要就所有实现类都是线程安全的
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="CacheFactory"></a><h3> CacheFactory </h3>
<pre>public static CacheConcurrencyStrategy createCache(Element node, String name, boolean mutable) 
private static CacheConcurrencyStrategy createCache(String usage, String name, boolean mutable) 

public方法内部获取node的usage属性，并调用private方法、根据不同的usage设置返回不同的CacheConcurrencyStrategy实现类。
这里，node是dom4j的xml节点对象，usage为not-null属性，可选值有read-write, read-only, nonstrict-read-write 或者 transactional。
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="CacheConcurrencyStrategy"></a><h3> CacheConcurrencyStrategy </h3>
<p>缓存并行策略类，用于协调缓存并行性调用。内含一个cache成员，作为缓存的物理承载。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="CacheProvider"></a><h3>  CacheProvider </h3>
<p>定义了四个方法：Cache buildCache(String regionName, Properties properties)、String regionName, Properties properties、void start(Properties properties) 、void stop()
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="Timestamper"></a><h3>  Timestamper </h3>
<p>用于获取timestamp的取值，在VM级保持增长（但不保证严格增长，但多数情况下如此 Identifiers are not necessarily strictly increasing, but usually are）
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="others"></a><h3> others </h3>
<p>各种Cache实现类及其对应Provider，以及QueryCache相关。
</p>
<pre>疑问：CacheFactory和CacheProvider都有返回Cache的方法，且名称含义类似，感觉是两个不同的分类，两者之间的关系还需要进一步研究。
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="cfg"></a><h2><i>cfg</i></h2>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name=".E6.A6.82.E8.BF.B0_3"></a><h3>概述</h3>
<pre>主要接口类：NamingStrategy
主要实体类：Environment、Settings
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="NamingStrategy"></a><h3> NamingStrategy </h3>
<p>定义了classToTableName、propertyToColumnName、tableName、propertyName、propertyToTableName五个方法，用于统一实体类到物理数据表的名称对应规则。
Hibernate提供的实现类有两个：DefaultNamingStrategy、ImprovedNamingStrategy。
DefaultNamingStrategy只是截取类的最短名称作为物理表名称映射（最后一个'.'后的字符串）
ImprovedNamingStrategy则在DefaultNamingStrategy处理方法基础上，对驼峰原则形式的类名称提供了加强，他在驼峰前加入'_'，并把所有字符转换成小写。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="Environment"></a><h3> Environment</h3>
<p>Environment类用于导入和保存环境变量：工厂级环境变量和系统级环境变量。工厂级环境变量是Hibernate设定的参数，只对单一项目实例起作用，由配置文件设定；系统级环境变量是VM级别的参数，用System.getProperties()获得，对所有项目起作用。
</p><p><i><b>初始化流程：</b></i>
</p>
<ol><li>初始化ISOLATION_LEVELS、OBSOLETE_PROPERTIES、GLOBAL_PROPERTIES三个HashMap（GLOBAL_PROPERTIES为子类Properties）。
<ul><li>ISOLATION_LEVELS		保存数据库事务相关的一组状态key=Integer, value=String。（和读写等有关，还不清楚是什么意思）
</li><li>OBSOLETE_PROPERTIES	版本更新引入的参数key值新旧替换，为了向前兼容。
</li><li>GLOBAL_PROPERTIES		所有环境参数的保存属性。这里的初始化只是手工加入了一个USE_REFLECTION_OPTIMIZER=TRUE的Entity
</li></ul>
</li><li>读取/hibernate.properties文件，将文件中的设置保存进GLOBAL_PROPERTIES，如果出错则忽略properties文件
</li><li>将System.getProperties()获取到的所有环境参数添加到GLOBAL_PROPERTIES中，如果出错则忽略系统级环境变量
</li><li>检查并替换GLOBAL_PROPERTIES的keySet中老的参数名称
</li><li>单独设置以下参数：
<ul><li>ENABLE_BINARY_STREAMS
</li><li>ENABLE_REFLECTION_OPTIMIZER
</li><li>JVM_SUPPORTS_GET_GENERATED_KEYS
</li><li>JVM_SUPPORTS_LINKED_HASH_COLLECTIONS
</li><li>JVM_HAS_TIMESTAMP_BUG
</li><li>JVM_HAS_JDK14_TIMESTAMP
</li></ul>
</li></ol>
<p>Environment.getProperties()方法返回一个GLOBAL_PROPERTIES的复制实体
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="Settings"></a><h3>Settings</h3>
<p>一个bean，用于保存影响Hibernate运行时行为的设定项。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="odmg"></a><h2> odmg </h2>
<p>ODMG(Object Database Management Group)一个已经解散的组织，他们到2001年为止制定到3.0版本的ODM标准。现在另外一个<a href="http://www.odbms.org/about_news_20060218.html" class='external text' title="http://www.odbms.org/about news 20060218.html" rel="nofollow">OMG</a>(Object Management Group)正在进行第四代对象数据库(OD,Object Database)标准的制定。这个标准规定了面向对象数据库的基本标准，Hibernate在这里进行ORM的时候按照这个标准进行的实现。
</p><p>另外，还可以参考<a href="http://java.sun.com/products/jdo/" class='external text' title="http://java.sun.com/products/jdo/" rel="nofollow">JDO</a>(Java Database Objects)的有关知识。
</p>
<pre>Hibernate只是实现了ODMG的基本接口，并没有对其提供更强大的支持，这个包的类在Hibernate其余部分的代码中并没有被使用或是引用。
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="Database"></a><h3>Database</h3>
<p>实现了odmg的Database API，他提供了持久化\删除对象，绑定名称到对象和按名称查找对象的操作。应用程序可以通过调用Implementation.newDatabase()或者直接实例化这个类来产生一个实例，这个实例应该随后通过调用open()来和一个已经存在的SessionFactory相关联。
</p><p>每个实例会将一个ThreadLocal和一个Transation相关联。
</p><p><a href="../../../%E5%85%B3/%E4%BA%8E/j/%E5%85%B3%E4%BA%8EJava%E7%BA%BF%E7%A8%8B%E7%9A%84%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86_9dcb.html" title="关于Java线程的补充知识">关于Java线程的补充知识</a>
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑</a>]</div><a name="collection"></a><h2>collection</h2>

<div class="printfooter">
<p>取自"<a href="http://dns.cs.hit.edu.cn../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html">http://dns.cs.hit.edu.cn../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html</a>"</p>

<p>本页面已经被浏览47次。 This page was last modified 02:48 2007年8月10日 by <a href="../../../d/y/i/User%7EDyingcow.html" title="User:Dyingcow">刘奭</a>.  </p>
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'><strong><a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑本页</a></strong> |
<a href="../../../h/i/b/Talk%7EHibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" class="new" title="Talk:Hibernate源代码阅读">讨论本页</a> |
<a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">较早版本</a> |
<a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a> |
<a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><br />

<br /><a href="../../../index.html" title="首页">首页</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%85%B3%E4%BA%8E.html" title="Wikipedia:关于">关于Wikipedia</a> | <a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> | <form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form><br /><span id="pagestats">本页面已经被浏览47次。 This page was last modified 02:48 2007年8月10日 by <a href="../../../d/y/i/User%7EDyingcow.html" title="User:Dyingcow">刘奭</a>.  </span></td></tr></table>
</div>
</div>

<div id='quickbar'>
<a href='../../../index.html'><img src='../../../../skins/common/images/wiki.jpg' alt='[首页]' /></a>
<hr class='sep' /><a href="../../../index.html">首页</a>
<br /><a href="../../../c/o/m/WIKI-HIT_IBM_CLUB%7ECommunity_Portal_9150.html">社区</a>
<br /><a href="../../../c/u/r/Current_events.html">新闻动态</a>
<br /><a href="../../../r/e/c/Special%7ERecentchanges.html">最近更改</a>
<br /><a href="../../../r/a/n/Special%7ERandom.html">随机页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html">帮助</a>
<br /><a href="../../../s/i/t/WIKI-HIT_IBM_CLUB%7ESite_support.html">Donations</a>
<br />
<hr class='sep' /><strong><a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">编辑本页</a></strong>
<br /><a href="../../../h/i/b/Talk%7EHibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" class="new" title="Talk:Hibernate源代码阅读">讨论本页</a>
<br /><a href="../../../h/i/b/Hibernate%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB.html" title="Hibernate源代码阅读">较早版本</a>
<br /><a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a>
<br /><a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><hr class='sep' /><a href="../../../s/p/e/Special%7ESpecialpages.html" title="Special:Specialpages">特殊页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E9%94%99%E8%AF%AF%E6%8A%A5%E5%91%8A.html" title="Wikipedia:错误报告">错误报告</a>
<br /></div>
<!-- Served by dns.cs.hit.edu.cn in 1351393173.32 secs. -->
</body></html>