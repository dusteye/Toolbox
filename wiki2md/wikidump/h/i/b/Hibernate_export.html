<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn" >
<head>
<title>Hibernate export - WIKI-HIT IBM CLUB</title>
<meta name="KEYWORDS" content="首页,ALP,Address,Android,Android Newbie Guide,Android Project Development,Android Research Field,Android Third Party Lib And Tool,BoardGame,CSAPP" />
<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
<meta name="robots" content="index,follow" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../../../../skins/common/wikiprintable.css' />
<script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
<style type='text/css'>
/*/*/ /*<![CDATA[*/
@import "../../../../skins/common/wikistandard.css";
@import "../../../s/t/a/MediaWiki%7EStandard.css.html";
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px; border-right: 1px solid gray; }
#article { margin-left: 152px; margin-right: 4px; }

/*]]>*/ /* */
</style>
</head>

<body bgcolor='#FFFFFF' onload=''>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
<td width='152' rowspan='1'>&nbsp;</td><td class="top" align='left' valign='top'>
<a href="../../../index.html" title="首页">首页</a> |
<a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> |
<a href="../../../h/i/b/Hibernate_export.html" title="Hibernate export">编辑本页</a> |
<a href="../../../h/i/b/Hibernate_export.html" title="Hibernate export">较早版本</a><p class='subtitle'><a href="../../../h/i/b/Hibernate_export.html">可打印版</a> | <a href="../../../g/e/n/WIKI-HIT_IBM_CLUB%7EGeneral_disclaimer.html" title="WIKI-HIT IBM CLUB:General disclaimer">Disclaimers</a></p>
</td>
<td class="top" valign='top' align='right' nowrap='nowrap'>Not logged in
<br /><a href="../../../u/s/e/Special%7EUserlogin.html" title="Special:Userlogin">登录</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html" title="Wikipedia:帮助">帮助</a>
<br /><form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form></td></tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">Hibernate export</h1><p class='subtitle'>Wikipedia，自由的百科全书</p>
<p>Hibernate DDL Export and SQL Length
</p><p>Warning! Long story ahead... One of the great features of Hibernate is what it calls "...roundtrip engineering" where you can begin with one artifact (a POJO, a database table, a Hibernate mapping file) and produce all the others from it. You can start with hibernate mapping files (.hbm) that describe your objects and then generate basic POJO's and your database schema (called DDM in Hibernate) using the Code Generation tools. You can also use Middlegen to generate your Hibernate Mapping Files directly from your database schema. Finally, you can produce mapping files from your compiled Java classes or from Java source with XDoclet markup (using HibernateDocletTask) which you could then use to produce DDM, which is what I spent time doing yesterday using Ant.
</p><p>This is a new project, so I only had a couple Java classes that needed the Hibernate XDoclet tags added. I noticed yesterday that Cedric Beust had released a JavaDoc Tag Plug-in for Eclipse that ships with a definition file for Hibernate, which made it easy to get started with the Hibernate tags (download it, unzip to the Eclipse 'plugins' folder and restart Eclipse). A super simple example class looks like this:
</p><p>package com.mycompany;
import java.io.Serializable;
/**
</p>
<ul><li> @hibernate.class table="dog"
</li><li>/
</li></ul>
<p>public class Dog extends BaseBean implements Serializable {
</p>
<pre> private String name;
 private String type;
 public Dog() { }
 /**
  * @hibernate.property name="name" type="string"
  * @hibernate.column name="name" length="255" not-null="true"
  * @return
  */
 public String getName() {
   return name;
 }
 /**
  * @hibernate.property name="type" type="string"
  * @hibernate.column name="type" length="255" not-null="true"
  * @return
  */
 public String getType() {
   return type;
 }
 public void setName(String name) {
   name = name;
 }
 public void setType(String type) {
   type = type;
 }
</pre>
<p>}
</p><p>After writing the class, the rest of your work is in Ant, which in turn uses XDoclet and the tools provided by Hibernate. You'll need to download and extract XDoclet to your system; I added a property to my Ant build file that specifies the location of XDoclet:
&lt;property name="xdoclet.home" value="C:\xdoclet-1.2.1"/&gt;
I read other people who recommended adding XDoclet to the /lib/ directory of your Ant installation. After doing either of the above, you'll need to define the HibernateDocletTask in Ant:
</p><p>&lt;taskdef name="hibernatedoclet"
</p>
<pre> classname="xdoclet.modules.hibernate.HibernateDocletTask"&gt;
 &lt;classpath refid="xdoclet.classpath"/&gt;
</pre>
<p>&lt;/taskdef&gt;
</p><p>and then you can use it inside a &lt;target&gt;:
</p><p>&lt;hibernatedoclet
</p>
<pre> destdir="WEB-INF/classes"
 excludedtags="@version,@author,@todo"
 force="true"
 mergedir="WEB-INF/classes"
 verbose="false"&gt;
 &lt;fileset dir="src"&gt;
   &lt;include name="com/mycompany/*.java"/&gt;
 &lt;/fileset&gt;
 &lt;hibernate version="2.0"/&gt;
</pre>
<p>&lt;/hibernatedoclet&gt;
</p><p>In the above example I have the Hibernate mapping files being generated to /WEB-INF/classes from the Java source filesthat live in the /src/com/mycompany directory. However, this leaves you having to manually update the master Hibernate configuration file (hibernate.cfg.xml) with the references to the generated mapping files. The Hibernate site shows how you can generate the configuration file using BeanShell, but it's easier than that. The latest version of XDoclet includes a task (HibernateCfgSubTask) that does it for you. Simple add this block of code:
</p><p>&lt;hibernatecfg
</p>
<pre> dataSource="java:comp/env/jdbc/pets"
 showSql="false"
 dialect="net.sf.hibernate.dialect.SQLServerDialect"
 destDir="WEB-INF/classes" /&gt;
</pre>
<p>right after the &lt;hibernate version="2.0" /&gt; in the above example. In this example I'm using JNDI to look up a datasource called "pets", I'm using the SQL Server Hibernate dialect, and I want the task to look in WEB-INF/classes for the Hibernate mapping files.
</p><p>Wait! We're not done yet! Because we now have Hibernate mapping files, we can generate a SQL script that will create the appropriate tables in the database. Again, the task needs to be defined:
</p><p>&lt;taskdef name="schemaexport" classname="net.sf.hibernate.tool.hbm2ddl.SchemaExportTask"&gt;
</p>
<pre> &lt;classpath refid="compile.classpath"/&gt;
</pre>
<p>&lt;/taskdef&gt;
</p><p>and then we can run the task:
</p><p>&lt;schemaexport
</p>
<pre> properties="src/hibernate.properties"
 quiet="yes" text="true" drop="false" delimiter=";"
 output="WEB-INF/classes/installation.sql"&gt;
 &lt;fileset dir="WEB-INF/classes" includes="**/*.hbm.xml"/&gt;
</pre>
<p>&lt;/schemaexport&gt;
</p><p>The task requires that you specify a Hibernate dialect using a properties file (why not add dialect as an attribute like the Hibernatecfg task?) and then can either write the generated SQL to a file or can run the generated SQL against a database.
</p><p>Anyway, all of this does lead up to a point. One of the puzzling things that I ran into was that I ended up specifying the type of the SQL column in my POJO using the @hibernate.column tag like this:
</p><p>@hibernate.column name="label" length="255" sql-type="nvarchar"
</p><p>If you specify a sql-type then the length attribute is not passed through to the generated SQL, which leaves you with SQL that looks like this:
</p><p>create table dog (
</p>
<pre> ...
 name VARCHAR,
 type VARCHAR,
 ...
</pre>
<p>);
</p><p>I'm not sure if this is by design or by accident, but Hibernate is open source, so it's easy to find a work around. The offending code is in the net.sf.hibernate.mapping.Column class and the net.sf.hibernate.mapping.Table class. The Table class is responsible for looping over every column defined in the mapping file and then calls the getSqlType() method on the Column. The Column instance is then responsible for either a) guessing at the SQL type (if type is not defined) or b) returning the defined SQL type. In (a), Hibernate actually does return a length; it guesses that because the property is of type string, that the column should be of SQL type 'varchar' and that the length should be 255 characters. But in (b), instead of returning the type and then the length, it only returns type, which in SQL Server means that you'll end up with all your varchar columns being 1 character in length. The workaround is to either go route (a) and let Hibernate guess what the column type and length should be or (b) you can specify length as part of the type. For instance:
</p><p>@hibernate.column name="type" sql-type="nvarchar (50)"
</p><p>which creates a nvarchar column of 50 characters. I know this syntax will work on MySQL as well as SQL Server, I'm not sure about the other database platforms that Hibernate supports. But the bigger question: bug or feature?
</p>
<div class="printfooter">
<p>取自"<a href="http://dns.cs.hit.edu.cn../../../h/i/b/Hibernate_export.html">http://dns.cs.hit.edu.cn../../../h/i/b/Hibernate_export.html</a>"</p>

<p>本页面已经被浏览5次。 This page was last modified 06:26 2006年7月16日 by <a href="../../../c/o/w/User%7ECowoo.html" title="User:Cowoo">陈伟</a>.  </p>
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'><strong><a href="../../../h/i/b/Hibernate_export.html" title="Hibernate export">编辑本页</a></strong> |
<a href="../../../h/i/b/Talk%7EHibernate_export.html" class="new" title="Talk:Hibernate export">讨论本页</a> |
<a href="../../../h/i/b/Hibernate_export.html" title="Hibernate export">较早版本</a> |
<a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a> |
<a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><br />

<br /><a href="../../../index.html" title="首页">首页</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%85%B3%E4%BA%8E.html" title="Wikipedia:关于">关于Wikipedia</a> | <a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> | <form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form><br /><span id="pagestats">本页面已经被浏览5次。 This page was last modified 06:26 2006年7月16日 by <a href="../../../c/o/w/User%7ECowoo.html" title="User:Cowoo">陈伟</a>.  </span></td></tr></table>
</div>
</div>

<div id='quickbar'>
<a href='../../../index.html'><img src='../../../../skins/common/images/wiki.jpg' alt='[首页]' /></a>
<hr class='sep' /><a href="../../../index.html">首页</a>
<br /><a href="../../../c/o/m/WIKI-HIT_IBM_CLUB%7ECommunity_Portal_9150.html">社区</a>
<br /><a href="../../../c/u/r/Current_events.html">新闻动态</a>
<br /><a href="../../../r/e/c/Special%7ERecentchanges.html">最近更改</a>
<br /><a href="../../../r/a/n/Special%7ERandom.html">随机页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html">帮助</a>
<br /><a href="../../../s/i/t/WIKI-HIT_IBM_CLUB%7ESite_support.html">Donations</a>
<br />
<hr class='sep' /><strong><a href="../../../h/i/b/Hibernate_export.html" title="Hibernate export">编辑本页</a></strong>
<br /><a href="../../../h/i/b/Talk%7EHibernate_export.html" class="new" title="Talk:Hibernate export">讨论本页</a>
<br /><a href="../../../h/i/b/Hibernate_export.html" title="Hibernate export">较早版本</a>
<br /><a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a>
<br /><a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><hr class='sep' /><a href="../../../s/p/e/Special%7ESpecialpages.html" title="Special:Specialpages">特殊页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E9%94%99%E8%AF%AF%E6%8A%A5%E5%91%8A.html" title="Wikipedia:错误报告">错误报告</a>
<br /></div>
<!-- Served by dns.cs.hit.edu.cn in 1351392841.22 secs. -->
</body></html>