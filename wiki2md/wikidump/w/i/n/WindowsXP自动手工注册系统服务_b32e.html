<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn" >
<head>
<title>WindowsXP自动手工注册系统服务 - WIKI-HIT IBM CLUB</title>
<meta name="KEYWORDS" content="首页,ALP,Address,Android,Android Newbie Guide,Android Project Development,Android Research Field,Android Third Party Lib And Tool,BoardGame,CSAPP" />
<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
<meta name="robots" content="index,follow" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../../../../skins/common/wikiprintable.css' />
<script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
<style type='text/css'>
/*/*/ /*<![CDATA[*/
@import "../../../../skins/common/wikistandard.css";
@import "../../../s/t/a/MediaWiki%7EStandard.css.html";
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px; border-right: 1px solid gray; }
#article { margin-left: 152px; margin-right: 4px; }

/*]]>*/ /* */
</style>
</head>

<body bgcolor='#FFFFFF' onload=''>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
<td width='152' rowspan='1'>&nbsp;</td><td class="top" align='left' valign='top'>
<a href="../../../index.html" title="首页">首页</a> |
<a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> |
<a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">编辑本页</a> |
<a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">较早版本</a><p class='subtitle'><a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html">可打印版</a> | <a href="../../../g/e/n/WIKI-HIT_IBM_CLUB%7EGeneral_disclaimer.html" title="WIKI-HIT IBM CLUB:General disclaimer">Disclaimers</a></p>
</td>
<td class="top" valign='top' align='right' nowrap='nowrap'>Not logged in
<br /><a href="../../../u/s/e/Special%7EUserlogin.html" title="Special:Userlogin">登录</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html" title="Wikipedia:帮助">帮助</a>
<br /><form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form></td></tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">WindowsXP自动手工注册系统服务</h1><p class='subtitle'>Wikipedia，自由的百科全书</p>
<table id='toc' class='toc'><tr><td><div id='toctitle'><h2>目录</h2></div>
<ul>
<li class='toclevel-1'><a href="#WindowsXP.E7.B3.BB.E7.BB.9F.E6.9C.8D.E5.8A.A1"><span class="tocnumber">1</span> <span class="toctext">WindowsXP系统服务</span></a>
<ul>
<li class='toclevel-2'><a href="#net"><span class="tocnumber">1.1</span> <span class="toctext">net</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="#.E6.B3.A8.E5.86.8C.E8.A1.A8"><span class="tocnumber">2</span> <span class="toctext">注册表</span></a></li>
<li class='toclevel-1'><a href="#INF"><span class="tocnumber">3</span> <span class="toctext">INF</span></a>
<ul>
<li class='toclevel-2'><a href="#addDB.inf"><span class="tocnumber">3.1</span> <span class="toctext">addDB.inf</span></a></li>
<li class='toclevel-2'><a href="#delDB.inf"><span class="tocnumber">3.2</span> <span class="toctext">delDB.inf</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="#Bat.E6.89.B9.E5.A4.84.E7.90.86"><span class="tocnumber">4</span> <span class="toctext">Bat批处理</span></a>
<ul>
<li class='toclevel-2'><a href="#Autorun.inf"><span class="tocnumber">4.1</span> <span class="toctext">Autorun.inf</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="#.E5.B0.BE.E5.A3.B0"><span class="tocnumber">5</span> <span class="toctext">尾声</span></a></li>
</ul>
</td></tr></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "显示"; var tocHideText = "隐藏"; showTocToggle(); } </script>
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">编辑</a>]</div><a name="WindowsXP.E7.B3.BB.E7.BB.9F.E6.9C.8D.E5.8A.A1"></a><h2>WindowsXP系统服务</h2>
<p>在系统启动的时候会自动启动很很多系统服务用于硬件驱动、内存管理、网络服务等多方面服务。services.msc是windows系统自带的服务管理器，net命令是对应的命令行方式工具。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">编辑</a>]</div><a name="net"></a><h3>net</h3>
<p>services.msc是图形界面的，没有什么好说的，都能看懂。而net，最常用的，也是我下面会用得到的两条指令就是：start和stop。
</p>
<pre>net start serviceName   //根据参数中的服务名称启动一项已经注册的服务，如果服务名还没有注册将报错。
</pre>
<pre>net stop serviceName    //停止一项服务
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">编辑</a>]</div><a name=".E6.B3.A8.E5.86.8C.E8.A1.A8"></a><h2>注册表</h2>
<p>和服务有关的注册表目录：
</p>
<pre>HKEY_LOCAL_MACHINE/SYSTEM/ControlSet001/Services
HKEY_LOCAL_MACHINE/SYSTEM/ControlSet002/Services
HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Services
</pre>
<p>可以在这三个地方找到系统中注册的各种服务，手动注册服务就从这里开始，我选择的是最后一个目录。
</p><p>首先，查看一下已经注册的服务我们可以看到每个服务都是以单独的节点的方式存在，节点内的一些键值描述了这个服务的一些信息和配置情况，最主要的有：
</p>
<table border="1">
<tr>
<th>名称</th><th>类型</th><th>数据
</th></tr>
<tr>
<td>DisplayName</td><td>REG_SZ</td><td>注册的服务名，用于net下唯一标识一个服务，比如我们用cliff
</td></tr>
<tr>
<td>Description</td><td>REG_SZ</td><td>描述信息
</td></tr>
<tr>
<td>ImagePath</td><td>REG_EXPAND_SZ</td><td>服务的可执行文件绝对路径
</td></tr>
<tr>
<td>Start</td><td>REG_DWORD</td><td>启动模式，有0、1、2、3、4可选
</td></tr>
<tr>
<td>Type</td><td>REG_DWORD</td><td>程序类型，0x10和0x20
</td></tr>
<tr>
<td>ErrorControl</td><td>REG_DWORD</td><td>出错处理
</td></tr></table>
<p><br />
上述表中的DisplayName、Start和ImagePath是最重要的，这里对Start的取值类型再作进一步说明：
</p>
<pre>start = {0,1,2,3,4}
0 == 由核心装载器装载
1 == 由I/O子系统装载
2 == 自动启动
3 == 手工启动
4 == 禁止启动
</pre>
<p>于是我们可以仿照这个结构创建我们自己的服务：
<a href="../../../x/p/s/Image%7EXPService.JPG_b47e.html" class="image" title="Image:XPService.JPG"><img src="../../../../upload/e/e2/XPService.JPG" alt="Image:XPService.JPG" width="649" height="154" longdesc="../../../x/p/s/Image%7EXPService.JPG_b47e.html" /></a>
</p><p>细心的你可能会发现在inetsvr下还有两个节点，的确你没有说错，在这里我偷了点懒，没有给你看手动注册的服务，而是截了一张利用后面将要提到的方法注册的服务。不过如果手工注册服务可以不建立那两个子节点，后面我们将会看到他们都是系统自动创建的，无须担心。
</p><p>创建完之后，你充满期待的打开services.msc，但是你没有找到你刚刚注册的服务名cliff，那意味着你将不能享受到cliff带给你的服务了！别急，重起一下系统试试，你会发现它已经在静静的等你了。
</p><p>好了，到此为止，我们已经可以手动注册系统服务了。但是我们也发现有一个很不好的地方，那就是我们需要重起系统。回想你可能安装过的Tomcat、MySQL等东东，没有重起系统也已经注册了服务，我们怎么能实现呢？
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">编辑</a>]</div><a name="INF"></a><h2>INF</h2>
<p>INF:Device INFormation File
</p><p>准备知识：<a href="../../../i/n/f/INF_9517.html" title="INF">INF</a>
</p><p>这里需要三个INF文件，一个用于注册并启动服务，一个用于停止并注销服务，最后一个用于在U盘插入的时候添加功能菜单。
</p><p>首先需要说明的是最终的实现和我最初的设想有些背离。开始是想让U盘在加载后自动运行批处理文件，应该是这样的：
</p>
<pre>[AutoRun]
open=setup.bat
</pre>
<p>但是经过试验发现并没有运行成功，所以采取了第二种方案，也是相对比较缓和的方案：在U盘的菜单中加入setup DB和unistall DB的选项。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">编辑</a>]</div><a name="addDB.inf"></a><h3>addDB.inf</h3>
<pre>[Version]
Signature="$WINDOWS NT$"
[DefaultInstall.Services]
addService=inetsvr,,My_AddService_Name
[My_AddService_Name]
DisplayName=FirebirdServer
Description=mobile DB Server
ServiceType=0x10
StartType=3
ErrorControl=0
ServiceBinary=%01%\bin\fbserver.exe -r
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">编辑</a>]</div><a name="delDB.inf"></a><h3>delDB.inf</h3>
<pre>[Version]
Signature="$WINDOWS NT$"
[DefaultInstall.Services]
delService=inetsvr,,My_DelService_Name
[My_DelService_Name]
DisplayName=FirebirdServer
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">编辑</a>]</div><a name="Bat.E6.89.B9.E5.A4.84.E7.90.86"></a><h2>Bat批处理</h2>
<p>最后，我希望达到的目的是U盘插上后自动注册服务，并启动服务。而上面创建的inf可以完成注册服务，它的调用可以用rundll32.exe配以相应参数来完成，所以.bat的批处理文件里就只有两行文字了：
</p>
<pre>@rundll32.exe setupapi,InstallHinfSection DefaultInstall 132 .\Firebird_2_0\addDB.inf
@net start FirebirdServer
</pre>
<p><b>注：前面的@是为了不显示着两条语句的执行过程，但是弹出黑框还是暂时不能避免，需进一步寻找方法。</b>
</p><p><br />
另一方面为了在卸除U盘的时候可以还原注册表，还需要一个uninstall.bat。里面也是调用一个inf，但是需要注意的是应该先停止服务！
</p>
<pre>@net stop FirebirdServer
@rundll32.exe setupapi,InstallHinfSection DefaultInstall 132 .\Firebird_2_0\delDB.inf
</pre>
<p>等一下，到现在这两个bat文件可以完成服务的自动注册、启动，停止、注销，但是我们忘记了一件事，那就是让他自动运行！下面一个经常与病毒联系到一起的文件就要出现了————autorun.inf！！
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">编辑</a>]</div><a name="Autorun.inf"></a><h3>Autorun.inf</h3>
<pre>[AutoRun]
shell\1=Open
shell\1\Command=explorer.exe \
shell\2=Setup DB
shell\2\Command=setup.bat
shell\3=Uninstall DB
shell\3\Command=uninstall.bat
</pre>
<p>这里说明一下，shell指令是用于在右键菜单中加入新的条目shell\序号代表了要加入的条目的顺序，但是好像只是相对顺序，都会被加到最开始的位置，并且第一条自动设置成双机打开，这也是为什么要加上shell\1的两行的原因了。在保留原有双击功能的前提下，需要手动调用explorer.exe。'\'代表打开当前路径，如果没有参数则会打开当前用户的我的文档。
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">编辑</a>]</div><a name=".E5.B0.BE.E5.A3.B0"></a><h2>尾声</h2>
<p>至此，所有的事情都已经做完了，让我们来整理一下U盘的目录结构：
</p>
<pre>root
  |----Autorun.inf
  |----setup.bat
  |----uninstall.bat
  |----Firebird_2_0
          |-------addDB.inf
          |-------delDB.inf
</pre>
<p>一共用到了三个inf，两个bat，实现了右键菜单方式的注册、启动，停止、卸载系统服务。
</p>
<div class="printfooter">
<p>取自"<a href="http://dns.cs.hit.edu.cn../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html">http://dns.cs.hit.edu.cn../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html</a>"</p>

<p>本页面已经被浏览27次。 This page was last modified 05:01 2007年1月6日 by <a href="../../../d/y/i/User%7EDyingcow.html" title="User:Dyingcow">刘奭</a>.  </p>
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'><strong><a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">编辑本页</a></strong> |
<a href="../../../w/i/n/Talk%7EWindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_c9c2.html" class="new" title="Talk:WindowsXP自动手工注册系统服务">讨论本页</a> |
<a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">较早版本</a> |
<a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a> |
<a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><br />

<br /><a href="../../../index.html" title="首页">首页</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%85%B3%E4%BA%8E.html" title="Wikipedia:关于">关于Wikipedia</a> | <a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> | <form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form><br /><span id="pagestats">本页面已经被浏览27次。 This page was last modified 05:01 2007年1月6日 by <a href="../../../d/y/i/User%7EDyingcow.html" title="User:Dyingcow">刘奭</a>.  </span></td></tr></table>
</div>
</div>

<div id='quickbar'>
<a href='../../../index.html'><img src='../../../../skins/common/images/wiki.jpg' alt='[首页]' /></a>
<hr class='sep' /><a href="../../../index.html">首页</a>
<br /><a href="../../../c/o/m/WIKI-HIT_IBM_CLUB%7ECommunity_Portal_9150.html">社区</a>
<br /><a href="../../../c/u/r/Current_events.html">新闻动态</a>
<br /><a href="../../../r/e/c/Special%7ERecentchanges.html">最近更改</a>
<br /><a href="../../../r/a/n/Special%7ERandom.html">随机页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html">帮助</a>
<br /><a href="../../../s/i/t/WIKI-HIT_IBM_CLUB%7ESite_support.html">Donations</a>
<br />
<hr class='sep' /><strong><a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">编辑本页</a></strong>
<br /><a href="../../../w/i/n/Talk%7EWindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_c9c2.html" class="new" title="Talk:WindowsXP自动手工注册系统服务">讨论本页</a>
<br /><a href="../../../w/i/n/WindowsXP%E8%87%AA%E5%8A%A8%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%86%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1_b32e.html" title="WindowsXP自动手工注册系统服务">较早版本</a>
<br /><a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a>
<br /><a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><hr class='sep' /><a href="../../../s/p/e/Special%7ESpecialpages.html" title="Special:Specialpages">特殊页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E9%94%99%E8%AF%AF%E6%8A%A5%E5%91%8A.html" title="Wikipedia:错误报告">错误报告</a>
<br /></div>
<!-- Served by dns.cs.hit.edu.cn in 1351393012.52 secs. -->
</body></html>