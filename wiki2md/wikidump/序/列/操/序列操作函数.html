<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn" >
<head>
<title>序列操作函数 - WIKI-HIT IBM CLUB</title>
<meta name="KEYWORDS" content="首页,ALP,Address,Android,Android Newbie Guide,Android Project Development,Android Research Field,Android Third Party Lib And Tool,BoardGame,CSAPP" />
<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
<meta name="robots" content="index,follow" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../../../../skins/common/wikiprintable.css' />
<script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
<style type='text/css'>
/*/*/ /*<![CDATA[*/
@import "../../../../skins/common/wikistandard.css";
@import "../../../s/t/a/MediaWiki%7EStandard.css.html";
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px; border-right: 1px solid gray; }
#article { margin-left: 152px; margin-right: 4px; }

/*]]>*/ /* */
</style>
</head>

<body bgcolor='#FFFFFF' onload=''>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
<td width='152' rowspan='1'>&nbsp;</td><td class="top" align='left' valign='top'>
<a href="../../../index.html" title="首页">首页</a> |
<a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> |
<a href="../../../%E5%BA%8F/%E5%88%97/%E6%93%8D/%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0.html" title="序列操作函数">编辑本页</a> |
<a href="../../../%E5%BA%8F/%E5%88%97/%E6%93%8D/%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0.html" title="序列操作函数">较早版本</a><p class='subtitle'><a href="../../../%E5%BA%8F/%E5%88%97/%E6%93%8D/%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0.html">可打印版</a> | <a href="../../../g/e/n/WIKI-HIT_IBM_CLUB%7EGeneral_disclaimer.html" title="WIKI-HIT IBM CLUB:General disclaimer">Disclaimers</a></p>
</td>
<td class="top" valign='top' align='right' nowrap='nowrap'>Not logged in
<br /><a href="../../../u/s/e/Special%7EUserlogin.html" title="Special:Userlogin">登录</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html" title="Wikipedia:帮助">帮助</a>
<br /><form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form></td></tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">序列操作函数</h1><p class='subtitle'>Wikipedia，自由的百科全书</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="../../../%E5%BA%8F/%E5%88%97/%E6%93%8D/%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0.html" title="序列操作函数">编辑</a>]</div><a name=".E5.BA.8F.E5.88.97.E6.93.8D.E4.BD.9C.E5.87.BD.E6.95.B0"></a><h2>序列操作函数</h2>
<p>本节描述 PostgreSQL 用于操作 序列对象的函数。序列对象(也叫序列生成器或者就是序列) 都是用 CREATE SEQUENCE 创建的特殊的单行表。 一个序列对象通常用于为行或者表生成唯一的标识符。 序列函数，在表 9-34 列出， 为我们从序列对象中获取后续的序列值提供了简单的，多用户安全的 方法。
</p>
<table border="1" cellspacing="0">
<caption> <b>表 9-34. 序列函数</b>
</caption>
<tr>
<td> 函数 </td><td> 返回类型 </td><td> 描述
</td></tr>
<tr>
<td>nextval(regclass) </td><td> bigint </td><td> 递增序列并返回新值
</td></tr>
<tr>
<td>currval(regclass) </td><td> bigint </td><td> 返回最近一次用nextval获取的指定序列的数值
</td></tr>
<tr>
<td>lastval() </td><td> bigint </td><td> 获取最近一次用 nextval 拿到的数值
</td></tr>
<tr>
<td>setval(regclass, bigint) </td><td> bigint </td><td> 设置序列的当前数值
</td></tr>
<tr>
<td>setval(regclass, bigint, boolean) </td><td> bigint </td><td> 设置序列的当前数值以及 is_called 标志
</td></tr></table>
<p>将要由序列函数调用操作的序列是用一个 regclass 参数声明的， 它只是序列在 pg_class 系统表里面的 OID。不过，你不需要手工查找 OID， 因为 regclass 数据类型的输入转换器会帮你做这件事情。 只要写出单引号包围的序列名字即可，因此它看上去像文本常量。 要达到和处理普通 SQL 名字的一些兼容性，这个字串将转换成小鞋， 除非在序列名字周围包含双引号，因此
</p>
<pre>  nextval('foo')      操作序列号 foo
  nextval('FOO')      操作序列号 foo
  nextval('"Foo"')    操作序列号 Foo
</pre>
<p>必要时序列名可以用模式修饰∶
</p>
<pre>  nextval('myschema.foo') 在 myschema.foo 上操作
  nextval('"myschema".foo') 同上
  nextval('foo')      为 foo 搜索搜索路径
</pre>
<p>参阅 Section 8.12 获取有关 regclass 的更多信息。
</p>
<dl><dd><b>注意:</b>在 PostgreSQL 8.1 之前，序列函数的参数类型是 text， 而不是 regclass，而上面描述的从文本字串到 OID 值的转换将在每次调用的时候发生。 为了向下兼容，这个设施仍然存在，但是在内部实际上是在函数调用前隐含地将 text 转换成 regclass 实现的。
</dd></dl>
<dl><dd>如果你把一个序列函数的参数写成一个无修饰的文本字串，那么它将变成类型为 regclass 的常量。 因为这只是一个 OID，它将跟踪最初标识的序列，而不管后面是否改名，模式变化等等。 这种"提前绑定"的行为通常是字段缺省和视图里面引用序列所需要的。 但是有时候你可能想要"推迟绑定"，这个时候序列的引用是在运行时解析的。 要获取推迟绑定的行为，我们可以强制常量存储为 text 常量，而不是 regclass：
</dd></dl>
<pre>   nextval('foo'::text)      foo 在运行时查找
</pre>
<dl><dd>请注意，推迟绑定是 PostgreSQL 版本 8.1 之前唯一可用的行为， 因此你可能需要在旧的应用里如此使用来保留旧有的语意。
</dd></dl>
<dl><dd>当然，序列函数的参数也可以是表达式。如果它是一个文本表达式，那么隐含的转换将导致运行时的查找。 
</dd></dl>
<p>可用的序列函数有∶
</p>
<dl><dd><b>nextval</b>
</dd></dl>
<dl><dd>递增序列对象到它的下一个数值并且返回该值。这个动作是自动完成的： 即使多个会话并发运行 nextval，每个进程也会安全地收到一个唯一的序列值。 
</dd></dl>
<dl><dd><b>currval</b>
</dd></dl>
<dl><dd>在当前会话中返回最近一次 nextval 抓到的该序列的数值。 （如果在本会话中从未在该序列上调用过 nextval， 那么会报告一个错误。）请注意因为此函数返回一个会话范围的数值， 它也能给出一个可预计的结果，可以判断其它会话是否执行过 nextval。 
</dd></dl>
<p>lastval
</p>
<dl><dd>返回当前会话里最近一次 nextval 返回的数值。 这个函数等效于 currval，只是它不用序列名位参数， 它抓取当前会话里面最近一次 nextval 使用的序列。 如果当前会话还没有调用过 nextval，那么调用 lastval 是会报错的。 
</dd></dl>
<dl><dd><b>setval</b>
</dd></dl>
<dl><dd>重置序列对象的计数器数值。双参数的形式设置序列的 last_value 字段为声明数值并且将其 is_called 字段设置为 true，表示下一次 nextval 将在返回数值之前递增该序列。在三参数形式里，is_called 可以设置为 true 或 false。如果你把它设置为 false，那么下一次 nextval 将返回这里声明的数值，而从随后的 nextval 才开始递增该序列。 比如
</dd></dl>
<pre>   SELECT setval('foo', 42);	   下次nextval将返回 43
   SELECT setval('foo', 42, true);     和上面一样
   SELECT setval('foo', 42, false);    下次nextval将返回 42
</pre>
<dl><dd>setval 返回的结果就是它的第二个参数的数值。 
</dd></dl>
<p>如果一个序列对象是带着缺省参数创建的，那么对它调用 nextval 将返回从1 开始的后续的数值。 其它的行为可以通过使用 CREATE SEQUENCE 命令里的 特殊参数获取；参阅其命令参考页获取更多信息。
</p>
<dl><dd><b>注意:</b> 为了避免从同一个序列获取数值的当前事务被阻塞， nextval 操作决不会回滚；也就是说，一旦一个数值已经被抓走， 那么就认为它已经用过了，即使调用 nextval 的事务后面又退出了也一样。这就意味着退出的事务可能在序列赋予的数值中留下"空洞"。 setval 操作也决不回滚。
</dd></dl>
<p><br />
PostgreSQL 7.4.24 Documentation
Prev	Fast Backward	Chapter 9. Functions and Operators	Fast Forward	Next
9.11. Sequence-Manipulation Functions
</p><p>This section describes PostgreSQL's functions for operating on sequence objects. Sequence objects (also called sequence generators or just sequences) are special single-row tables created with CREATE SEQUENCE. A sequence object is usually used to generate unique identifiers for rows of a table. The sequence functions, listed in Table 9-34, provide simple, multiuser-safe methods for obtaining successive sequence values from sequence objects.
</p><p>Table 9-34. Sequence Functions
</p><p>Function	Return Type	Description
</p><p>nextval(text)	bigint	Advance sequence and return new value
</p><p>currval(text)	bigint	Return value most recently obtained with nextval
</p><p>setval(text, bigint)	bigint	Set sequence's current value
</p><p>setval(text, bigint, boolean)	bigint	Set sequence's current value and is_called flag
</p><p>For largely historical reasons, the sequence to be operated on by a sequence-function call is specified by a text-string argument. To achieve some compatibility with the handling of ordinary SQL names, the sequence functions convert their argument to lower case unless the string is double-quoted. Thus
</p><p>nextval('foo')      operates on sequence foo
</p><p>nextval('FOO')      operates on sequence foo
</p><p>nextval('"Foo"')    operates on sequence Foo
</p><p><br />
The sequence name can be schema-qualified if necessary:
</p><p>nextval('myschema.foo')     operates on myschema.foo
</p><p>nextval('"myschema".foo')   same as above
</p><p>nextval('foo')              searches search path for foo
</p><p><br />
Of course, the text argument can be the result of an expression, not only a simple literal, which is occasionally useful.
</p><p>The available sequence functions are:
</p><p>nextval
</p><p>Advance the sequence object to its next value and return that value. This is done atomically: even if multiple sessions execute nextval concurrently, each will safely receive a distinct sequence value. 
currval
</p><p>Return the value most recently obtained by nextval for this sequence in the current session. (An error is reported if nextval has never been called for this sequence in this session.) Notice that because this is returning a session-local value, it gives a predictable answer even if other sessions are executing nextval meanwhile. 
setval
</p><p>Reset the sequence object's counter value. The two-parameter form sets the sequence's last_value field to the specified value and sets its is_called field to true, meaning that the next nextval will advance the sequence before returning a value. In the three-parameter form, is_called may be set either true or false. If it's set to false, the next nextval will return exactly the specified value, and sequence advancement commences with the following nextval. For example,
</p><p>SELECT setval('foo', 42);           Next nextval will return 43
</p><p>SELECT setval('foo', 42, true);     Same as above
</p><p>SELECT setval('foo', 42, false);    Next nextval will return 42
</p><p>The result returned by setval is just the value of its second argument. 
</p><p>Important: To avoid blocking of concurrent transactions that obtain numbers from the same sequence, a nextval operation is never rolled back; that is, once a value has been fetched it is considered used, even if the transaction that did the nextval later aborts. This means that aborted transactions may leave unused "holes" in the sequence of assigned values. setval operations are never rolled back, either. 
</p><p>If a sequence object has been created with default parameters, nextval calls on it will return successive values beginning with 1. Other behaviors can be obtained by using special parameters in the CREATE SEQUENCE command; see its command reference page for more information.
</p>
<div class="printfooter">
<p>取自"<a href="http://dns.cs.hit.edu.cn../../../%E5%BA%8F/%E5%88%97/%E6%93%8D/%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0.html">http://dns.cs.hit.edu.cn../../../%E5%BA%8F/%E5%88%97/%E6%93%8D/%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0.html</a>"</p>

<p>本页面已经被浏览7次。 This page was last modified 08:03 2009年5月16日 by <a href="../../../%E5%BC%A0/%E6%99%BA/_/User%7E%E5%BC%A0%E6%99%BA.html" class="new" title="User:张智">张智</a>.  </p>
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'><strong><a href="../../../%E5%BA%8F/%E5%88%97/%E6%93%8D/%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0.html" title="序列操作函数">编辑本页</a></strong> |
<a href="../../../%E5%BA%8F/%E5%88%97/%E6%93%8D/Talk%7E%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0.html" class="new" title="Talk:序列操作函数">讨论本页</a> |
<a href="../../../%E5%BA%8F/%E5%88%97/%E6%93%8D/%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0.html" title="序列操作函数">较早版本</a> |
<a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a> |
<a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><br />

<br /><a href="../../../index.html" title="首页">首页</a> | <a href="../../../w/i/k/Wikipedia%7E%E5%85%B3%E4%BA%8E.html" title="Wikipedia:关于">关于Wikipedia</a> | <a href="../../../r/e/c/Special%7ERecentchanges.html" title="Special:Recentchanges">最近更改</a> | <form name="search" class="inline" method="post" action="../../../s/e/a/Special%7ESearch.html">
<input type="text" name="search" size="19" value="" />
<input type="submit" name="go" value="进入" />&nbsp;<input type="submit" name="fulltext" value="搜索" />
</form><br /><span id="pagestats">本页面已经被浏览7次。 This page was last modified 08:03 2009年5月16日 by <a href="../../../%E5%BC%A0/%E6%99%BA/_/User%7E%E5%BC%A0%E6%99%BA.html" class="new" title="User:张智">张智</a>.  </span></td></tr></table>
</div>
</div>

<div id='quickbar'>
<a href='../../../index.html'><img src='../../../../skins/common/images/wiki.jpg' alt='[首页]' /></a>
<hr class='sep' /><a href="../../../index.html">首页</a>
<br /><a href="../../../c/o/m/WIKI-HIT_IBM_CLUB%7ECommunity_Portal_9150.html">社区</a>
<br /><a href="../../../c/u/r/Current_events.html">新闻动态</a>
<br /><a href="../../../r/e/c/Special%7ERecentchanges.html">最近更改</a>
<br /><a href="../../../r/a/n/Special%7ERandom.html">随机页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E5%B8%AE%E5%8A%A9.html">帮助</a>
<br /><a href="../../../s/i/t/WIKI-HIT_IBM_CLUB%7ESite_support.html">Donations</a>
<br />
<hr class='sep' /><strong><a href="../../../%E5%BA%8F/%E5%88%97/%E6%93%8D/%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0.html" title="序列操作函数">编辑本页</a></strong>
<br /><a href="../../../%E5%BA%8F/%E5%88%97/%E6%93%8D/Talk%7E%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0.html" class="new" title="Talk:序列操作函数">讨论本页</a>
<br /><a href="../../../%E5%BA%8F/%E5%88%97/%E6%93%8D/%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0.html" title="序列操作函数">较早版本</a>
<br /><a href="../../../w/h/a/Special%7EWhatlinkshere.html" title="Special:Whatlinkshere">链入页面</a>
<br /><a href="../../../r/e/c/Special%7ERecentchangeslinked.html" title="Special:Recentchangeslinked">链出更改</a>
<br /><hr class='sep' /><a href="../../../s/p/e/Special%7ESpecialpages.html" title="Special:Specialpages">特殊页面</a>
<br /><a href="../../../w/i/k/Wikipedia%7E%E9%94%99%E8%AF%AF%E6%8A%A5%E5%91%8A.html" title="Wikipedia:错误报告">错误报告</a>
<br /></div>
<!-- Served by dns.cs.hit.edu.cn in 1351393356.43 secs. -->
</body></html>